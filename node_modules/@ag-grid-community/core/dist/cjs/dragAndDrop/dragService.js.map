{"version":3,"sources":["../../src/ts/dragAndDrop/dragService.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,8CAAgF;AAEhF,oCAAuE;AAGvE,gDAA+C;AAC/C,4CAAgD;AAChD,wCAAiD;AACjD,wCAA+C;AAE/C;iGACiG;AAEjG;IAAiC,+BAAQ;IAAzC;QAAA,qEA8RC;QAhRW,sBAAgB,GAAe,EAAE,CAAC;QAElC,iBAAW,GAA4B,EAAE,CAAC;;IA8QtD,CAAC;IA3QW,0BAAI,GAAZ;QACI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;IAC3D,CAAC;IAGO,wCAAkB,GAA1B;QACI,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACzD,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC;IAChC,CAAC;IAEO,oCAAc,GAAtB,UAAuB,qBAA4C;QAC/D,IAAM,OAAO,GAAG,qBAAqB,CAAC,UAAU,CAAC,QAAQ,CAAC;QAC1D,IAAM,iBAAiB,GAAG,qBAAqB,CAAC,iBAAiB,CAAC;QAClE,OAAO,CAAC,mBAAmB,CAAC,WAAW,EAAE,iBAAiB,CAAC,CAAC;QAE5D,0CAA0C;QAC1C,IAAI,qBAAqB,CAAC,YAAY,EAAE;YACpC,IAAM,kBAAkB,GAAG,qBAAqB,CAAC,kBAAkB,CAAC;YACpE,OAAO,CAAC,mBAAmB,CAAC,YAAY,EAAE,kBAAmB,EAAE,EAAC,OAAO,EAAC,IAAI,EAAQ,CAAC,CAAC;SACzF;IACL,CAAC;IAEM,sCAAgB,GAAvB,UAAwB,MAA0B;QAC9C,IAAM,qBAAqB,GAAG,cAAI,CAAC,IAAI,CAAC,WAAW,EAAE,UAAA,IAAI,IAAI,OAAA,IAAI,CAAC,UAAU,KAAK,MAAM,EAA1B,CAA0B,CAAC,CAAC;QAEzF,IAAI,CAAC,qBAAqB,EAAE;YAAE,OAAO;SAAE;QAEvC,IAAI,CAAC,cAAc,CAAC,qBAAqB,CAAC,CAAC;QAC3C,uBAAe,CAAC,IAAI,CAAC,WAAW,EAAE,qBAAqB,CAAC,CAAC;IAC7D,CAAC;IAEM,gCAAU,GAAjB;QACI,OAAO,IAAI,CAAC,QAAQ,CAAC;IACzB,CAAC;IAEM,mCAAa,GAApB,UAAqB,MAA0B,EAAE,YAA6B;QAA9E,iBAsBC;QAtBgD,6BAAA,EAAA,oBAA6B;QAC1E,IAAM,aAAa,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;QAC1D,MAAM,CAAC,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC;QAE7D,IAAI,aAAa,GAA8C,IAAI,CAAC;QAEpE,IAAM,aAAa,GAAG,IAAI,CAAC,kBAAkB,CAAC,eAAe,EAAE,CAAC;QAEhE,IAAI,YAAY,IAAI,CAAC,aAAa,EAAE;YAChC,aAAa,GAAG,UAAC,UAAsB;gBACnC,UAAU,CAAC,cAAc,EAAE,CAAC;gBAC5B,KAAI,CAAC,YAAY,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;YAC1C,CAAC,CAAC;YACF,MAAM,CAAC,QAAQ,CAAC,gBAAgB,CAAC,YAAY,EAAE,aAAa,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;SACpF;QAED,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;YAClB,UAAU,EAAE,MAAM;YAClB,iBAAiB,EAAE,aAAa;YAChC,kBAAkB,EAAE,aAAa;YACjC,YAAY,EAAE,YAAY;SAC7B,CAAC,CAAC;IACP,CAAC;IAED,qDAAqD;IAC7C,kCAAY,GAApB,UAAqB,MAA0B,EAAE,UAAsB;QAAvE,iBA8BC;QA7BG,IAAI,CAAC,iBAAiB,GAAG,MAAM,CAAC;QAChC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QAEtB,IAAM,KAAK,GAAG,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QAEpC,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;QAC3B,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QAExB,IAAM,cAAc,GAAG,UAAC,CAAa,IAAK,OAAA,KAAI,CAAC,WAAW,CAAC,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,EAApC,CAAoC,CAAC;QAC/E,IAAM,aAAa,GAAG,UAAC,CAAa,IAAK,OAAA,KAAI,CAAC,SAAS,CAAC,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,EAAlC,CAAkC,CAAC;QAC5E,IAAM,iBAAiB,GAAG,UAAC,CAAa,IAAO,IAAI,CAAC,CAAC,UAAU,EAAE;YAAE,CAAC,CAAC,cAAc,EAAE,CAAC;SAAE,CAAC,CAAC,CAAC;QAC3F,IAAM,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC;QAE/B,IAAM,MAAM,GAAG;YACX,6EAA6E;YAC7E,mFAAmF;YACnF,gGAAgG;YAChG,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,WAAW,EAAE,QAAQ,EAAE,iBAAiB,EAAE,OAAO,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE;YACjG,EAAE,MAAM,QAAA,EAAE,IAAI,EAAE,WAAW,EAAE,QAAQ,EAAE,cAAc,EAAE,OAAO,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,EAAE;YACnF,EAAE,MAAM,QAAA,EAAE,IAAI,EAAE,UAAU,EAAE,QAAQ,EAAE,aAAa,EAAE,OAAO,EAAE,EAAE,OAAO,EAAE,IAAI,EAAC,EAAE;YAChF,EAAE,MAAM,QAAA,EAAE,IAAI,EAAE,aAAa,EAAE,QAAQ,EAAE,aAAa,EAAE,OAAO,EAAE,EAAE,OAAO,EAAE,IAAI,EAAC,EAAE;SACtF,CAAC;QACF,+DAA+D;QAC/D,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;QAEhC,iDAAiD;QACjD,IAAI,MAAM,CAAC,eAAe,KAAK,CAAC,EAAE;YAC9B,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,UAAU,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;SAC9D;IACL,CAAC;IAED,qDAAqD;IAC7C,iCAAW,GAAnB,UAAoB,MAA0B,EAAE,UAAsB;QAAtE,iBAwCC;QAvCG,IAAM,CAAC,GAAG,UAAiB,CAAC;QAE5B,IAAI,MAAM,CAAC,cAAc,IAAI,MAAM,CAAC,cAAc,CAAC,UAAU,CAAC,EAAE;YAC5D,OAAO;SACV;QAED,sFAAsF;QACtF,0FAA0F;QAC1F,+FAA+F;QAC/F,IAAI,CAAC,CAAC,8BAA8B,EAAE;YAAE,OAAO;SAAE;QAEjD,CAAC,CAAC,8BAA8B,GAAG,IAAI,CAAC;QAExC,wCAAwC;QACxC,IAAI,UAAU,CAAC,MAAM,KAAK,CAAC,EAAE;YAAE,OAAO;SAAE;QAExC,IAAI,CAAC,iBAAiB,GAAG,MAAM,CAAC;QAChC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QAEtB,IAAI,CAAC,eAAe,GAAG,UAAU,CAAC;QAElC,IAAM,SAAS,GAAG,IAAI,CAAC,kBAAkB,CAAC,WAAW,EAAE,CAAC;QAExD,IAAM,cAAc,GAAG,UAAC,KAAiB,IAAK,OAAA,KAAI,CAAC,WAAW,CAAC,KAAK,EAAE,MAAM,CAAC,QAAQ,CAAC,EAAxC,CAAwC,CAAC;QACvF,IAAM,YAAY,GAAG,UAAC,KAAiB,IAAK,OAAA,KAAI,CAAC,SAAS,CAAC,KAAK,EAAE,MAAM,CAAC,QAAQ,CAAC,EAAtC,CAAsC,CAAC;QACnF,IAAM,YAAY,GAAG,UAAC,KAAiB,IAAK,OAAA,KAAK,CAAC,cAAc,EAAE,EAAtB,CAAsB,CAAC;QACnE,IAAM,MAAM,GAAG,SAAS,CAAC;QACzB,IAAM,MAAM,GAAG;YACX,EAAE,MAAM,QAAA,EAAE,IAAI,EAAE,WAAW,EAAE,QAAQ,EAAE,cAAc,EAAE;YACvD,EAAE,MAAM,QAAA,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,EAAE,YAAY,EAAE;YACnD,EAAE,MAAM,QAAA,EAAE,IAAI,EAAE,aAAa,EAAE,QAAQ,EAAE,YAAY,EAAE;SAC1D,CAAC;QACF,+DAA+D;QAC/D,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC;QAEhC,gDAAgD;QAChD,IAAI,MAAM,CAAC,eAAe,KAAK,CAAC,EAAE;YAC9B,IAAI,CAAC,WAAW,CAAC,UAAU,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;SACjD;IACL,CAAC;IAEO,wCAAkB,GAA1B,UACI,MAKG;QAEH,MAAM,CAAC,OAAO,CAAC,UAAC,YAAY;YAChB,IAAA,4BAAM,EAAE,wBAAI,EAAE,gCAAQ,EAAE,8BAAO,CAAkB;YACzD,MAAM,CAAC,gBAAgB,CAAC,IAAI,EAAE,QAAe,EAAE,OAAO,CAAC,CAAC;QAC5D,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC;YACvB,MAAM,CAAC,OAAO,CAAC,UAAC,YAAY;gBAChB,IAAA,4BAAM,EAAE,wBAAI,EAAE,gCAAQ,EAAE,8BAAO,CAAkB;gBACzD,MAAM,CAAC,mBAAmB,CAAC,IAAI,EAAE,QAAe,EAAE,OAAO,CAAC,CAAC;YAC/D,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IAED,0GAA0G;IAC1G,mGAAmG;IAC3F,2CAAqB,GAA7B,UAA8B,YAAgC,EAAE,UAA8B;QAC1F,wDAAwD;QAChD,IAAA,wDAAe,CAA6B;QACpD,IAAM,iBAAiB,GAAG,gBAAM,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;QACxE,OAAO,qBAAa,CAAC,YAAY,EAAE,UAAU,EAAE,iBAAiB,CAAC,CAAC;IACtE,CAAC;IAEO,yCAAmB,GAA3B,UAA4B,SAAoB;QAC5C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACvC,IAAI,SAAS,CAAC,CAAC,CAAC,CAAC,UAAU,KAAK,IAAI,CAAC,UAAW,CAAC,UAAU,EAAE;gBACzD,OAAO,SAAS,CAAC,CAAC,CAAC,CAAC;aACvB;SACJ;QACD,OAAO,IAAI,CAAC;IAChB,CAAC;IAEO,kCAAY,GAApB,UAAqB,YAAgC,EAAE,UAA8B,EAAE,EAAe;QAClG,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YAChB,uEAAuE;YACvE,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,qBAAqB,CAAC,YAAY,EAAE,UAAU,CAAC,EAAE;gBAAE,OAAO;aAAE;YAEvF,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;YACrB,IAAM,OAAK,GAAqB;gBAC5B,IAAI,EAAE,eAAM,CAAC,kBAAkB;gBAC/B,GAAG,EAAE,IAAI,CAAC,OAAO;gBACjB,SAAS,EAAE,IAAI,CAAC,SAAS;gBACzB,MAAM,EAAE,EAAE;aACb,CAAC;YACF,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,OAAK,CAAC,CAAC;YAEvC,IAAI,CAAC,iBAAkB,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;YAChD,uFAAuF;YACvF,wFAAwF;YACxF,qFAAqF;YACrF,oFAAoF;YACpF,yFAAyF;YACzF,4FAA4F;YAC5F,wCAAwC;YACxC,IAAI,CAAC,iBAAkB,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;SAClD;QAED,IAAI,CAAC,iBAAkB,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;IACrD,CAAC;IAEO,iCAAW,GAAnB,UAAoB,UAAsB,EAAE,EAAe;QACvD,IAAM,KAAK,GAAG,IAAI,CAAC,mBAAmB,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QAC3D,IAAI,CAAC,KAAK,EAAE;YAAE,OAAO;SAAE;QAEvB,kGAAkG;QAClG,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,UAAW,EAAE,EAAE,CAAC,CAAC;IACnD,CAAC;IAED,8EAA8E;IAC9E,sCAAsC;IAC9B,iCAAW,GAAnB,UAAoB,UAAsB,EAAE,EAAe;QACvD,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,IAAI,CAAC,eAAgB,EAAE,EAAE,CAAC,CAAC;IAC7D,CAAC;IAEM,+BAAS,GAAhB,UAAiB,UAAsB,EAAE,EAAe;QACpD,IAAI,KAAK,GAAG,IAAI,CAAC,mBAAmB,CAAC,UAAU,CAAC,cAAc,CAAC,CAAC;QAEhE,gEAAgE;QAChE,iEAAiE;QACjE,8DAA8D;QAC9D,gEAAgE;QAChE,iBAAiB;QACjB,IAAI,CAAC,KAAK,EAAE;YACR,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC;SAC9B;QAED,sEAAsE;QACtE,oEAAoE;QACpE,4BAA4B;QAC5B,mDAAmD;QAEnD,IAAI,CAAC,UAAU,CAAC,KAAM,EAAE,EAAE,CAAC,CAAC;QAE5B,oBAAoB;QACpB,gDAAgD;QAChD,aAAa;QACb,yBAAyB;QACzB,IAAI;IACR,CAAC;IAEM,+BAAS,GAAhB,UAAiB,UAAsB,EAAE,EAAe;QACpD,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;IACpC,CAAC;IAEM,gCAAU,GAAjB,UAAkB,YAAgC,EAAE,EAAe;QAC/D,IAAI,IAAI,CAAC,QAAQ,EAAE;YACf,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;YACtB,IAAI,CAAC,iBAAkB,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;YACjD,IAAM,OAAK,GAAqB;gBAC5B,IAAI,EAAE,eAAM,CAAC,kBAAkB;gBAC/B,GAAG,EAAE,IAAI,CAAC,OAAO;gBACjB,SAAS,EAAE,IAAI,CAAC,SAAS;gBACzB,MAAM,EAAE,EAAE;aACb,CAAC;YACF,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,OAAK,CAAC,CAAC;SAC1C;QAED,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;QAC5B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QACvB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;QAE9B,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,UAAA,IAAI,IAAI,OAAA,IAAI,EAAE,EAAN,CAAM,CAAC,CAAC;QAC9C,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC;IACrC,CAAC;IA3R2B;QAA3B,mBAAS,CAAC,eAAe,CAAC;sDAAsC;IACzC;QAAvB,mBAAS,CAAC,WAAW,CAAC;kDAA8B;IAC/B;QAArB,mBAAS,CAAC,SAAS,CAAC;gDAA0B;IAe/C;QADC,uBAAa;2CAGb;IAGD;QADC,oBAAU;yDAIV;IA3BQ,WAAW;QADvB,cAAI,CAAC,aAAa,CAAC;OACP,WAAW,CA8RvB;IAAD,kBAAC;CA9RD,AA8RC,CA9RgC,mBAAQ,GA8RxC;AA9RY,kCAAW","file":"dragService.js","sourcesContent":["import { Bean, PreDestroy, Autowired, PostConstruct } from \"../context/context\";\nimport { LoggerFactory, Logger } from \"../logger\";\nimport { DragStartedEvent, DragStoppedEvent, Events } from \"../events\";\nimport { ColumnApi } from \"../columns/columnApi\";\nimport { GridApi } from \"../gridApi\";\nimport { BeanStub } from \"../context/beanStub\";\nimport { find, exists } from \"../utils/generic\";\nimport { removeFromArray } from \"../utils/array\";\nimport { areEventsNear } from \"../utils/mouse\";\n\n/** Adds drag listening onto an element. In AG Grid this is used twice, first is resizing columns,\n * second is moving the columns and column groups around (ie the 'drag' part of Drag and Drop. */\n@Bean('dragService')\nexport class DragService extends BeanStub {\n\n    @Autowired('loggerFactory') private loggerFactory: LoggerFactory;\n    @Autowired('columnApi') private columnApi: ColumnApi;\n    @Autowired('gridApi') private gridApi: GridApi;\n\n    private currentDragParams: DragListenerParams | null;\n    private dragging: boolean;\n    private mouseStartEvent: MouseEvent | null;\n    private touchLastTime: Touch | null;\n    private touchStart: Touch | null;\n\n    private logger: Logger;\n\n    private dragEndFunctions: Function[] = [];\n\n    private dragSources: DragSourceAndListener[] = [];\n\n    @PostConstruct\n    private init(): void {\n        this.logger = this.loggerFactory.create('DragService');\n    }\n\n    @PreDestroy\n    private removeAllListeners(): void {\n        this.dragSources.forEach(this.removeListener.bind(this));\n        this.dragSources.length = 0;\n    }\n\n    private removeListener(dragSourceAndListener: DragSourceAndListener): void {\n        const element = dragSourceAndListener.dragSource.eElement;\n        const mouseDownListener = dragSourceAndListener.mouseDownListener;\n        element.removeEventListener('mousedown', mouseDownListener);\n\n        // remove touch listener only if it exists\n        if (dragSourceAndListener.touchEnabled) {\n            const touchStartListener = dragSourceAndListener.touchStartListener;\n            element.removeEventListener('touchstart', touchStartListener!, {passive:true} as any);\n        }\n    }\n\n    public removeDragSource(params: DragListenerParams): void {\n        const dragSourceAndListener = find(this.dragSources, item => item.dragSource === params);\n\n        if (!dragSourceAndListener) { return; }\n\n        this.removeListener(dragSourceAndListener);\n        removeFromArray(this.dragSources, dragSourceAndListener);\n    }\n\n    public isDragging(): boolean {\n        return this.dragging;\n    }\n\n    public addDragSource(params: DragListenerParams, includeTouch: boolean = false): void {\n        const mouseListener = this.onMouseDown.bind(this, params);\n        params.eElement.addEventListener('mousedown', mouseListener);\n\n        let touchListener: ((touchEvent: TouchEvent) => void) | null = null;\n\n        const suppressTouch = this.gridOptionsWrapper.isSuppressTouch();\n\n        if (includeTouch && !suppressTouch) {\n            touchListener = (touchEvent: TouchEvent) => { \n                touchEvent.preventDefault();\n                this.onTouchStart(params, touchEvent);\n            };\n            params.eElement.addEventListener('touchstart', touchListener, { passive: true });\n        }\n\n        this.dragSources.push({\n            dragSource: params,\n            mouseDownListener: mouseListener,\n            touchStartListener: touchListener,\n            touchEnabled: includeTouch\n        });\n    }\n\n    // gets called whenever mouse down on any drag source\n    private onTouchStart(params: DragListenerParams, touchEvent: TouchEvent): void {\n        this.currentDragParams = params;\n        this.dragging = false;\n\n        const touch = touchEvent.touches[0];\n\n        this.touchLastTime = touch;\n        this.touchStart = touch;\n\n        const touchMoveEvent = (e: TouchEvent) => this.onTouchMove(e, params.eElement);\n        const touchEndEvent = (e: TouchEvent) => this.onTouchUp(e, params.eElement);\n        const documentTouchMove = (e: TouchEvent) => { if (e.cancelable) { e.preventDefault(); } };\n        const target = params.eElement;\n\n        const events = [\n            // Prevents the page document from moving while we are dragging items around.\n            // preventDefault needs to be called in the touchmove listener and never inside the\n            // touchstart, because using touchstart causes the click event to be cancelled on touch devices.\n            { target: document, type: 'touchmove', listener: documentTouchMove, options: { passive: false } },\n            { target, type: 'touchmove', listener: touchMoveEvent, options: { passive: true } },\n            { target, type: 'touchend', listener: touchEndEvent, options: { passive: true} },\n            { target, type: 'touchcancel', listener: touchEndEvent, options: { passive: true} }\n        ];\n        // temporally add these listeners, for the duration of the drag\n        this.addTemporaryEvents(events);\n\n        // see if we want to start dragging straight away\n        if (params.dragStartPixels === 0) {\n            this.onCommonMove(touch, this.touchStart, params.eElement);\n        }\n    }\n\n    // gets called whenever mouse down on any drag source\n    private onMouseDown(params: DragListenerParams, mouseEvent: MouseEvent): void {\n        const e = mouseEvent as any;\n\n        if (params.skipMouseEvent && params.skipMouseEvent(mouseEvent)) {\n            return;\n        }\n\n        // if there are two elements with parent / child relationship, and both are draggable,\n        // when we drag the child, we should NOT drag the parent. an example of this is row moving\n        // and range selection - row moving should get preference when use drags the rowDrag component.\n        if (e._alreadyProcessedByDragService) { return; }\n\n        e._alreadyProcessedByDragService = true;\n\n        // only interested in left button clicks\n        if (mouseEvent.button !== 0) { return; }\n\n        this.currentDragParams = params;\n        this.dragging = false;\n\n        this.mouseStartEvent = mouseEvent;\n\n        const eDocument = this.gridOptionsWrapper.getDocument();\n\n        const mouseMoveEvent = (event: MouseEvent) => this.onMouseMove(event, params.eElement);\n        const mouseUpEvent = (event: MouseEvent) => this.onMouseUp(event, params.eElement);\n        const contextEvent = (event: MouseEvent) => event.preventDefault();\n        const target = eDocument;\n        const events = [\n            { target, type: 'mousemove', listener: mouseMoveEvent },\n            { target, type: 'mouseup', listener: mouseUpEvent },\n            { target, type: 'contextmenu', listener: contextEvent }\n        ];\n        // temporally add these listeners, for the duration of the drag\n        this.addTemporaryEvents(events);\n\n        //see if we want to start dragging straight away\n        if (params.dragStartPixels === 0) {\n            this.onMouseMove(mouseEvent, params.eElement);\n        }\n    }\n\n    private addTemporaryEvents(\n        events: {\n            target: HTMLElement | Document,\n            type: string,\n            listener: (e: MouseEvent | TouchEvent, el: HTMLElement) => void,\n            options?: any\n        }[]\n    ): void {\n        events.forEach((currentEvent) => {\n            const { target, type, listener, options } = currentEvent;\n            target.addEventListener(type, listener as any, options);\n        });\n\n        this.dragEndFunctions.push(() => {\n            events.forEach((currentEvent) => {\n                const { target, type, listener, options } = currentEvent;\n                target.removeEventListener(type, listener as any, options);\n            });\n        });\n    }\n\n    // returns true if the event is close to the original event by X pixels either vertically or horizontally.\n    // we only start dragging after X pixels so this allows us to know if we should start dragging yet.\n    private isEventNearStartEvent(currentEvent: MouseEvent | Touch, startEvent: MouseEvent | Touch): boolean {\n        // by default, we wait 4 pixels before starting the drag\n        const { dragStartPixels } = this.currentDragParams!;\n        const requiredPixelDiff = exists(dragStartPixels) ? dragStartPixels : 4;\n        return areEventsNear(currentEvent, startEvent, requiredPixelDiff);\n    }\n\n    private getFirstActiveTouch(touchList: TouchList): Touch | null {\n        for (let i = 0; i < touchList.length; i++) {\n            if (touchList[i].identifier === this.touchStart!.identifier) {\n                return touchList[i];\n            }\n        }\n        return null;\n    }\n\n    private onCommonMove(currentEvent: MouseEvent | Touch, startEvent: MouseEvent | Touch, el: HTMLElement): void {\n        if (!this.dragging) {\n            // if mouse hasn't travelled from the start position enough, do nothing\n            if (!this.dragging && this.isEventNearStartEvent(currentEvent, startEvent)) { return; }\n\n            this.dragging = true;\n            const event: DragStartedEvent = {\n                type: Events.EVENT_DRAG_STARTED,\n                api: this.gridApi,\n                columnApi: this.columnApi,\n                target: el\n            };\n            this.eventService.dispatchEvent(event);\n\n            this.currentDragParams!.onDragStart(startEvent);\n            // we need ONE drag action at the startEvent, so that we are guaranteed the drop target\n            // at the start gets notified. this is because the drag can start outside of the element\n            // that started it, as the mouse is allowed drag away from the mouse down before it's\n            // considered a drag (the isEventNearStartEvent() above). if we didn't do this, then\n            // it would be possible to click a column by the edge, then drag outside of the drop zone\n            // in less than 4 pixels and the drag officially starts outside of the header but the header\n            // wouldn't be notified of the dragging.\n            this.currentDragParams!.onDragging(startEvent);\n        }\n\n        this.currentDragParams!.onDragging(currentEvent);\n    }\n\n    private onTouchMove(touchEvent: TouchEvent, el: HTMLElement): void {\n        const touch = this.getFirstActiveTouch(touchEvent.touches);\n        if (!touch) { return; }\n\n        // this.___statusPanel.setInfoText(Math.random() + ' onTouchMove preventDefault stopPropagation');\n        this.onCommonMove(touch, this.touchStart!, el);\n    }\n\n    // only gets called after a mouse down - as this is only added after mouseDown\n    // and is removed when mouseUp happens\n    private onMouseMove(mouseEvent: MouseEvent, el: HTMLElement): void {\n        this.onCommonMove(mouseEvent, this.mouseStartEvent!, el);\n    }\n\n    public onTouchUp(touchEvent: TouchEvent, el: HTMLElement): void {\n        let touch = this.getFirstActiveTouch(touchEvent.changedTouches);\n\n        // i haven't worked this out yet, but there is no matching touch\n        // when we get the touch up event. to get around this, we swap in\n        // the last touch. this is a hack to 'get it working' while we\n        // figure out what's going on, why we are not getting a touch in\n        // current event.\n        if (!touch) {\n            touch = this.touchLastTime;\n        }\n\n        // if mouse was left up before we started to move, then this is a tap.\n        // we check this before onUpCommon as onUpCommon resets the dragging\n        // let tap = !this.dragging;\n        // let tapTarget = this.currentDragParams.eElement;\n\n        this.onUpCommon(touch!, el);\n\n        // if tap, tell user\n        // console.log(`${Math.random()} tap = ${tap}`);\n        // if (tap) {\n        //     tapTarget.click();\n        // }\n    }\n\n    public onMouseUp(mouseEvent: MouseEvent, el: HTMLElement): void {\n        this.onUpCommon(mouseEvent, el);\n    }\n\n    public onUpCommon(eventOrTouch: MouseEvent | Touch, el: HTMLElement): void {\n        if (this.dragging) {\n            this.dragging = false;\n            this.currentDragParams!.onDragStop(eventOrTouch);\n            const event: DragStoppedEvent = {\n                type: Events.EVENT_DRAG_STOPPED,\n                api: this.gridApi,\n                columnApi: this.columnApi,\n                target: el\n            };\n            this.eventService.dispatchEvent(event);\n        }\n\n        this.mouseStartEvent = null;\n        this.touchStart = null;\n        this.touchLastTime = null;\n        this.currentDragParams = null;\n\n        this.dragEndFunctions.forEach(func => func());\n        this.dragEndFunctions.length = 0;\n    }\n}\n\ninterface DragSourceAndListener {\n    dragSource: DragListenerParams;\n    mouseDownListener: (mouseEvent: MouseEvent) => void;\n    touchEnabled: boolean;\n    touchStartListener: ((touchEvent: TouchEvent) => void) | null;\n}\n\nexport interface DragListenerParams {\n    /** After how many pixels of dragging should the drag operation start. Default is 4px. */\n    dragStartPixels?: number;\n    /** Dom element to add the drag handling to */\n    eElement: HTMLElement;\n    /** Some places may wish to ignore certain events, eg range selection ignores shift clicks */\n    skipMouseEvent?: (mouseEvent: MouseEvent) => boolean;\n    /** Callback for drag starting */\n    onDragStart: (mouseEvent: MouseEvent | Touch) => void;\n    /** Callback for drag stopping */\n    onDragStop: (mouseEvent: MouseEvent | Touch) => void;\n    /** Callback for mouse move while dragging */\n    onDragging: (mouseEvent: MouseEvent | Touch) => void;\n}\n"]}