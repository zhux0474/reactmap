{"version":3,"sources":["../../src/ts/headerRendering/cells/floatingFilter/headerFilterCellCtrl.ts"],"names":[],"mappings":"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","file":"headerFilterCellCtrl.js","sourcesContent":["\nimport { HeaderRowCtrl } from \"../../row/headerRowCtrl\";\nimport { AbstractHeaderCellCtrl, IAbstractHeaderCellComp } from \"../abstractCell/abstractHeaderCellCtrl\";\nimport { UserComponentFactory } from '../../../components/framework/userComponentFactory';\nimport { KeyCode } from '../../../constants/keyCode';\nimport { Autowired, Optional } from '../../../context/context';\nimport { Column } from '../../../entities/column';\nimport { Events, FilterChangedEvent } from '../../../events';\nimport { FilterManager } from '../../../filter/filterManager';\nimport { IFloatingFilter, IFloatingFilterParams } from '../../../filter/floating/floatingFilter';\nimport { FloatingFilterMapper } from '../../../filter/floating/floatingFilterMapper';\nimport { GridApi } from '../../../gridApi';\nimport { IFilterComp, IFilterDef } from '../../../interfaces/iFilter';\nimport { IMenuFactory } from '../../../interfaces/iMenuFactory';\nimport { ModuleNames } from '../../../modules/moduleNames';\nimport { ModuleRegistry } from '../../../modules/moduleRegistry';\nimport { Beans } from '../../../rendering/beans';\nimport { ColumnHoverService } from '../../../rendering/columnHoverService';\nimport { SetLeftFeature } from '../../../rendering/features/setLeftFeature';\nimport { AgPromise } from '../../../utils';\nimport { isElementChildOfClass, containsClass } from '../../../utils/dom';\nimport { createIconNoSpan } from '../../../utils/icon';\nimport { ManagedFocusFeature } from '../../../widgets/managedFocusFeature';\nimport { HoverFeature } from '../hoverFeature';\nimport { UserCompDetails } from \"../../../components/framework/userComponentFactory\";\nimport { FrameworkComponentWrapper } from \"../../../components/framework/frameworkComponentWrapper\";\n\nexport interface IHeaderFilterCellComp extends IAbstractHeaderCellComp {\n    addOrRemoveCssClass(cssClassName: string, on: boolean): void;\n    addOrRemoveBodyCssClass(cssClassName: string, on: boolean): void;\n    addOrRemoveButtonWrapperCssClass(cssClassName: string, on: boolean): void;\n    setCompDetails(compDetails: UserCompDetails): void;\n    getFloatingFilterComp(): AgPromise<IFloatingFilter> | null;\n    setWidth(width: string): void;\n    setMenuIcon(icon: HTMLElement): void;\n}\n\nexport class HeaderFilterCellCtrl extends AbstractHeaderCellCtrl {\n\n    @Autowired('userComponentFactory') private readonly userComponentFactory: UserComponentFactory;\n    @Autowired('filterManager') private readonly filterManager: FilterManager;\n    @Autowired('columnHoverService') private readonly columnHoverService: ColumnHoverService;\n    @Autowired('gridApi') private readonly gridApi: GridApi;\n    @Autowired('menuFactory') private readonly menuFactory: IMenuFactory;\n    @Autowired('beans') protected readonly beans: Beans;\n    @Optional('frameworkComponentWrapper') private frameworkComponentWrapper: FrameworkComponentWrapper;\n\n    private comp: IHeaderFilterCellComp;\n\n    private column: Column;\n\n    private eButtonShowMainFilter: HTMLElement;\n    private eFloatingFilterBody: HTMLElement;\n\n    private suppressFilterButton: boolean;\n    private active: boolean;\n\n    constructor(column: Column, parentRowCtrl: HeaderRowCtrl) {\n        super(column, parentRowCtrl);\n        this.column = column;\n    }\n\n    public setComp(comp: IHeaderFilterCellComp, eGui: HTMLElement, eButtonShowMainFilter: HTMLElement, eFloatingFilterBody: HTMLElement): void {\n        super.setGui(eGui);\n        this.comp = comp;\n        this.eButtonShowMainFilter = eButtonShowMainFilter;\n        this.eFloatingFilterBody = eFloatingFilterBody;\n\n        const colDef = this.column.getColDef();\n        // const active = !(!(colDef.filter && colDef.floatingFilter) && !(colDef.filterFramework && colDef.floatingFilterComponentFramework));\n        this.active = (!!colDef.filter || !!colDef.filterFramework) && !!colDef.floatingFilter;\n\n        this.setupWidth();\n        this.setupLeft();\n        this.setupHover();\n        this.setupFocus();\n        this.setupUserComp();\n        this.setupSyncWithFilter();\n        this.setupUi();\n\n        this.addManagedListener(this.eButtonShowMainFilter, 'click', this.showParentFilter.bind(this));\n    }\n\n    private setupUi(): void {\n\n        this.comp.addOrRemoveButtonWrapperCssClass('ag-hidden', !this.active || this.suppressFilterButton);\n\n        if (!this.active) { return; }\n\n        this.comp.addOrRemoveBodyCssClass('ag-floating-filter-full-body', this.suppressFilterButton);\n        this.comp.addOrRemoveBodyCssClass('ag-floating-filter-body', !this.suppressFilterButton);\n\n        const eMenuIcon = createIconNoSpan('filter', this.gridOptionsWrapper, this.column);\n\n        if (eMenuIcon) {\n            this.eButtonShowMainFilter.appendChild(eMenuIcon);\n        }\n    }\n\n    private setupFocus(): void {\n        this.createManagedBean(new ManagedFocusFeature(\n            this.eGui,\n            {\n                shouldStopEventPropagation: this.shouldStopEventPropagation.bind(this),\n                onTabKeyDown: this.onTabKeyDown.bind(this),\n                handleKeyDown: this.handleKeyDown.bind(this),\n                onFocusIn: this.onFocusIn.bind(this)\n            }\n        ));\n    }\n\n    protected onTabKeyDown(e: KeyboardEvent) {\n        const activeEl = document.activeElement as HTMLElement;\n        const wrapperHasFocus = activeEl === this.eGui;\n\n        if (wrapperHasFocus) { return; }\n\n        const nextFocusableEl = this.focusService.findNextFocusableElement(this.eGui, null, e.shiftKey);\n\n        if (nextFocusableEl) {\n            e.preventDefault();\n            nextFocusableEl.focus();\n        }\n    }\n\n    protected handleKeyDown(e: KeyboardEvent) {\n        const activeEl = document.activeElement;\n        const wrapperHasFocus = activeEl === this.eGui;\n\n        switch (e.keyCode) {\n            case KeyCode.UP:\n            case KeyCode.DOWN:\n                if (!wrapperHasFocus) {\n                    e.preventDefault();\n                }\n            case KeyCode.LEFT:\n            case KeyCode.RIGHT:\n                if (wrapperHasFocus) { return; }\n                e.stopPropagation();\n            case KeyCode.ENTER:\n                if (wrapperHasFocus) {\n                    if (this.focusService.focusInto(this.eGui)) {\n                        e.preventDefault();\n                    }\n                }\n                break;\n            case KeyCode.ESCAPE:\n                if (!wrapperHasFocus) {\n                    this.eGui.focus();\n                }\n        }\n    }\n\n    protected onFocusIn(e: FocusEvent): void {\n        const isRelatedWithin = this.eGui.contains(e.relatedTarget as HTMLElement);\n\n        // when the focus is already within the component,\n        // we default to the browser's behavior\n        if (isRelatedWithin) { return; }\n\n        const keyboardMode = this.focusService.isKeyboardMode();\n        const notFromHeaderWrapper = !!e.relatedTarget && !containsClass(e.relatedTarget as HTMLElement, 'ag-floating-filter');\n        const fromWithinHeader = !!e.relatedTarget && isElementChildOfClass(e.relatedTarget as HTMLElement, 'ag-floating-filter');\n\n        if (keyboardMode && notFromHeaderWrapper && fromWithinHeader && e.target === this.eGui) {\n            const lastFocusEvent = this.lastFocusEvent;\n            const fromTab = !!(lastFocusEvent && lastFocusEvent.keyCode === KeyCode.TAB);\n\n            if (lastFocusEvent && fromTab) {\n                const currentFocusedHeader = this.beans.focusService.getFocusedHeader();\n                const nextColumn = this.beans.columnModel.getDisplayedColAfter(this.column);\n                const fromNextColumn = currentFocusedHeader && nextColumn === currentFocusedHeader.column;\n                const shouldFocusLast = !!(keyboardMode && lastFocusEvent.shiftKey && fromNextColumn);\n\n                this.focusService.focusInto(this.eGui, shouldFocusLast);\n            }\n         }\n\n        const rowIndex = this.getRowIndex();\n        this.beans.focusService.setFocusedHeader(rowIndex, this.column);\n    }\n\n    private setupHover(): void {\n        this.createManagedBean(new HoverFeature([this.column], this.eGui));\n\n        const listener = () => {\n            if (!this.gridOptionsWrapper.isColumnHoverHighlight()) { return; }\n            const hovered = this.columnHoverService.isHovered(this.column);\n            this.comp.addOrRemoveCssClass('ag-column-hover', hovered);\n        };\n\n        this.addManagedListener(this.eventService, Events.EVENT_COLUMN_HOVER_CHANGED, listener);\n        listener();\n    }\n\n    private setupLeft(): void {\n        const setLeftFeature = new SetLeftFeature(this.column, this.eGui, this.beans);\n        this.createManagedBean(setLeftFeature);\n    }\n\n    private setupUserComp(): void {\n\n        if (!this.active) { return; }\n\n        const colDef = this.column.getColDef();\n\n        const filterParams = this.filterManager.createFilterParams(this.column, colDef);\n        const finalFilterParams = this.userComponentFactory.mergeParamsWithApplicationProvidedParams(colDef, 'filter', filterParams);\n\n        let defaultFloatingFilterType = HeaderFilterCellCtrl.getDefaultFloatingFilterType(colDef);\n        if (defaultFloatingFilterType == null) {\n            defaultFloatingFilterType = 'agReadOnlyFloatingFilter';\n        }\n\n        const params: IFloatingFilterParams = {\n            api: this.gridApi,\n            column: this.column,\n            filterParams: finalFilterParams,\n            currentParentModel: this.currentParentModel.bind(this),\n            parentFilterInstance: this.parentFilterInstance.bind(this),\n            showParentFilter: this.showParentFilter.bind(this),\n            onFloatingFilterChanged: this.onFloatingFilterChanged.bind(this),\n            suppressFilterButton: false // This one might be overridden from the colDef\n        };\n\n        // this is unusual - we need a params value OUTSIDE the component the params are for.\n        // the params are for the floating filter component, but this property is actually for the wrapper.\n        this.suppressFilterButton = colDef.floatingFilterComponentParams ? !!colDef.floatingFilterComponentParams.suppressFilterButton : false;\n\n        const compDetails = this.userComponentFactory.getFloatingFilterCompDetails(colDef, params, defaultFloatingFilterType);\n        if (compDetails) {\n            this.comp.setCompDetails(compDetails);\n        }\n    }\n\n    public static getDefaultFloatingFilterType(def: IFilterDef): string | null {\n        if (def == null) { return null; }\n\n        let defaultFloatingFilterType: string | null = null;\n\n        if (typeof def.filter === 'string') {\n            // will be undefined if not in the map\n            defaultFloatingFilterType = FloatingFilterMapper.getFloatingFilterType(def.filter);\n        } else if (def.filterFramework) {\n            // If filterFramework, then grid is NOT using one of the provided filters, hence no default.\n            // Note: We could combine this with another part of the 'if' statement, however explicitly\n            // having this section makes the code easier to read.\n        } else if (def.filter === true) {\n            const setFilterModuleLoaded = ModuleRegistry.isRegistered(ModuleNames.SetFilterModule);\n            defaultFloatingFilterType = setFilterModuleLoaded ? 'agSetColumnFloatingFilter' : 'agTextColumnFloatingFilter';\n        }\n\n        return defaultFloatingFilterType;\n    }\n\n    private currentParentModel(): any {\n        const filterComponent = this.getFilterComponent(false);\n\n        return filterComponent ? filterComponent.resolveNow(null, filter => filter && filter.getModel()) : null;\n    }\n\n    private getFilterComponent(createIfDoesNotExist = true): AgPromise<IFilterComp> | null {\n        return this.filterManager.getFilterComponent(this.column, 'NO_UI', createIfDoesNotExist);\n    }\n\n    private onFloatingFilterChanged(): void {\n        console.warn('AG Grid: since version 21.x, how floating filters are implemented has changed. ' +\n            'Instead of calling params.onFloatingFilterChanged(), get a reference to the main filter via ' +\n            'params.parentFilterInstance() and then set a value on the parent filter directly.');\n    }\n\n    private parentFilterInstance(callback: (filterInstance: IFilterComp) => void): void {\n        const filterComponent = this.getFilterComponent();\n\n        if (filterComponent) {\n            filterComponent.then(instance => {\n                const instanceUnwrapped = this.frameworkComponentWrapper ? this.frameworkComponentWrapper.unwrap(instance) : instance;\n                callback(instanceUnwrapped);\n            });\n        }\n    }\n\n    private showParentFilter() {\n        const eventSource = this.suppressFilterButton ? this.eFloatingFilterBody : this.eButtonShowMainFilter;\n        this.menuFactory.showMenuAfterButtonClick(this.column, eventSource, 'floatingFilter', 'filterMenuTab', ['filterMenuTab']);\n    }\n\n    private setupSyncWithFilter(): void {\n        if (!this.active) { return; }\n\n        const syncWithFilter = (filterChangedEvent: FilterChangedEvent | null) => {\n            const compPromise = this.comp.getFloatingFilterComp();\n            if (!compPromise) { return; }\n            const parentModel = this.currentParentModel();\n            compPromise.then(comp => comp && comp.onParentModelChanged(parentModel, filterChangedEvent));\n        };\n\n        this.addManagedListener(this.column, Column.EVENT_FILTER_CHANGED, syncWithFilter);\n\n        if (this.filterManager.isFilterActive(this.column)) {\n            syncWithFilter(null);\n        }\n    }\n\n    private setupWidth(): void {\n        const listener = () => {\n            const width = `${this.column.getActualWidth()}px`;\n            this.comp.setWidth(width);\n        };\n\n        this.addManagedListener(this.column, Column.EVENT_WIDTH_CHANGED, listener);\n        listener();\n    }\n\n}\n"]}