{"version":3,"sources":["../../src/ts/headerRendering/cells/column/resizeFeature.ts"],"names":[],"mappings":"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","file":"resizeFeature.js","sourcesContent":["import { ColumnModel } from \"../../../columns/columnModel\";\nimport { Constants } from \"../../../constants/constants\";\nimport { BeanStub } from \"../../../context/beanStub\";\nimport { Autowired, PostConstruct } from \"../../../context/context\";\nimport { Column } from \"../../../entities/column\";\nimport { setDisplayed } from \"../../../utils/dom\";\nimport { TouchListener } from \"../../../widgets/touchListener\";\nimport { HorizontalResizeService } from \"../../common/horizontalResizeService\";\nimport { HeaderCellCtrl, IHeaderCellComp } from \"./headerCellCtrl\";\n\nexport class ResizeFeature extends BeanStub {\n\n    @Autowired('horizontalResizeService') private horizontalResizeService: HorizontalResizeService;\n    @Autowired('columnModel') private columnModel: ColumnModel;\n\n    private pinned: string | null;\n    private column: Column;\n    private eResize: HTMLElement;\n    private comp: IHeaderCellComp;\n\n    private resizeStartWidth: number;\n    private resizeWithShiftKey: boolean;\n\n    private ctrl: HeaderCellCtrl;\n\n    constructor(pinned: string | null, column: Column, eResize: HTMLElement, comp: IHeaderCellComp, \n                ctrl: HeaderCellCtrl) {\n        super();\n        this.pinned = pinned;\n        this.column = column;\n        this.eResize = eResize;\n        this.comp = comp;\n        this.ctrl = ctrl;\n    }\n\n    @PostConstruct\n    private postConstruct(): void {\n        const colDef = this.column.getColDef();\n\n        const destroyResizeFuncs: (() => void)[] = [];\n\n        let canResize: boolean;\n        let canAutosize: boolean;\n\n        const addResize = () => {\n            setDisplayed(this.eResize, canResize);\n\n            if (!canResize) { return; }\n\n            const finishedWithResizeFunc = this.horizontalResizeService.addResizeBar({\n                eResizeBar: this.eResize,\n                onResizeStart: this.onResizeStart.bind(this),\n                onResizing: this.onResizing.bind(this, false),\n                onResizeEnd: this.onResizing.bind(this, true)\n            });\n            destroyResizeFuncs.push(finishedWithResizeFunc);\n\n            if (canAutosize) {\n                const skipHeaderOnAutoSize = this.gridOptionsWrapper.isSkipHeaderOnAutoSize();\n\n                const autoSizeColListener = () => {\n                    this.columnModel.autoSizeColumn(this.column, skipHeaderOnAutoSize, \"uiColumnResized\");\n                };\n\n                this.eResize.addEventListener('dblclick', autoSizeColListener);\n                const touchListener: TouchListener = new TouchListener(this.eResize);\n                touchListener.addEventListener(TouchListener.EVENT_DOUBLE_TAP, autoSizeColListener);\n\n                this.addDestroyFunc(() => {\n                    this.eResize.removeEventListener('dblclick', autoSizeColListener);\n                    touchListener.removeEventListener(TouchListener.EVENT_DOUBLE_TAP, autoSizeColListener);\n                    touchListener.destroy();\n                });\n            }\n        };\n\n        const removeResize = () => {\n            destroyResizeFuncs.forEach(f => f());\n            destroyResizeFuncs.length = 0;\n        };\n\n        const refresh = () => {\n            const resize = this.column.isResizable();\n            const autoSize = !this.gridOptionsWrapper.isSuppressAutoSize() && !colDef.suppressAutoSize;\n            const propertyChange = resize !== canResize || autoSize !== canAutosize;\n            if (propertyChange) {\n                canResize = resize;\n                canAutosize = autoSize;\n                removeResize();\n                addResize();\n            }\n        };\n\n        refresh();\n        this.addDestroyFunc(removeResize);\n        this.ctrl.addRefreshFunction(refresh);\n    }\n\n    private onResizing(finished: boolean, resizeAmount: number): void {\n        const resizeAmountNormalised = this.normaliseResizeAmount(resizeAmount);\n        const columnWidths = [{ key: this.column, newWidth: this.resizeStartWidth + resizeAmountNormalised }];\n        this.columnModel.setColumnWidths(columnWidths, this.resizeWithShiftKey, finished, \"uiColumnDragged\");\n\n        if (finished) {\n            this.comp.addOrRemoveCssClass('ag-column-resizing', false);\n        }\n    }\n\n    private onResizeStart(shiftKey: boolean): void {\n        this.resizeStartWidth = this.column.getActualWidth();\n        this.resizeWithShiftKey = shiftKey;\n\n        this.comp.addOrRemoveCssClass('ag-column-resizing', true);\n    }\n\n    // optionally inverts the drag, depending on pinned and RTL\n    // note - this method is duplicated in RenderedHeaderGroupCell - should refactor out?\n    private normaliseResizeAmount(dragChange: number): number {\n        let result = dragChange;\n\n        const notPinningLeft = this.pinned !== Constants.PINNED_LEFT;\n        const pinningRight = this.pinned === Constants.PINNED_RIGHT;\n\n        if (this.gridOptionsWrapper.isEnableRtl()) {\n            // for RTL, dragging left makes the col bigger, except when pinning left\n            if (notPinningLeft) {\n                result *= -1;\n            }\n        } else {\n            // for LTR (ie normal), dragging left makes the col smaller, except when pinning right\n            if (pinningRight) {\n                result *= -1;\n            }\n        }\n\n        return result;\n    }\n\n}"]}