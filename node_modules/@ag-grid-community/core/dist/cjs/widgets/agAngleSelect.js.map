{"version":3,"sources":["../../src/ts/widgets/agAngleSelect.ts"],"names":[],"mappings":"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","file":"agAngleSelect.js","sourcesContent":["import { AgAbstractLabel, IAgLabel } from \"./agAbstractLabel\";\nimport { RefSelector } from \"./componentAnnotations\";\nimport { Autowired } from \"../context/context\";\nimport { DragService, DragListenerParams } from \"../dragAndDrop/dragService\";\nimport { AgInputNumberField } from \"./agInputNumberField\";\nimport { AgAbstractField } from \"./agAbstractField\";\nimport { exists } from \"../utils/generic\";\nimport { setFixedWidth } from \"../utils/dom\";\n\nexport class AgAngleSelect extends AgAbstractLabel {\n\n    private static TEMPLATE = /* html */\n        `<div class=\"ag-angle-select\">\n            <div ref=\"eLabel\"></div>\n            <div class=\"ag-wrapper ag-angle-select-wrapper\">\n                <div ref=\"eAngleSelectField\" class=\"ag-angle-select-field\">\n                    <div ref=\"eParentCircle\" class=\"ag-angle-select-parent-circle\">\n                        <div ref=\"eChildCircle\" class=\"ag-angle-select-child-circle\"></div>\n                    </div>\n                </div>\n                <ag-input-number-field ref=\"eAngleValue\"></ag-input-number-field>\n            </div>\n        </div>`;\n\n    @RefSelector('eLabel') protected readonly eLabel: HTMLElement;\n    @RefSelector('eParentCircle') private readonly eParentCircle: HTMLElement;\n    @RefSelector('eChildCircle') private readonly eChildCircle: HTMLElement;\n    @RefSelector('eAngleValue') private readonly eAngleValue: AgInputNumberField;\n\n    @Autowired('dragService') protected readonly dragService: DragService;\n\n    private parentCircleRect: ClientRect | DOMRect;\n    private degrees: number;\n    private radius: number = 0;\n    private offsetX: number = 0;\n    private offsetY: number = 0;\n    private dragListener: DragListenerParams;\n\n    constructor(config?: IAgLabel) {\n        super(config, AgAngleSelect.TEMPLATE);\n    }\n\n    postConstruct() {\n        super.postConstruct();\n\n        this.dragListener = {\n            eElement: this.eParentCircle,\n            dragStartPixels: 0,\n            onDragStart: (e: MouseEvent | Touch) => {\n                this.parentCircleRect = this.eParentCircle.getBoundingClientRect();\n            },\n            onDragging: (e: MouseEvent | Touch) => this.calculateAngleDrag(e),\n            onDragStop: () => { }\n        };\n\n        this.dragService.addDragSource(this.dragListener);\n\n        this.eAngleValue\n            .setLabel('')\n            .setLabelWidth(5)\n            .setInputWidth(45)\n            .setMin(0)\n            .setMax(360)\n            .setValue(`${this.degrees}`)\n            .onValueChange((value: string) => {\n                if (value == null || value === '') {\n                    value = '0';\n                }\n                value = this.eAngleValue.normalizeValue(value);\n                let floatValue = parseFloat(value);\n                if (floatValue > 180) {\n                    floatValue = floatValue - 360;\n                }\n                this.setValue(floatValue);\n            });\n\n        this.updateNumberInput();\n\n        if (exists(this.getValue())) {\n            this.eAngleValue.setValue(this.normalizeNegativeValue(this.getValue()).toString());\n        }\n\n        this.addManagedListener(this, AgAbstractField.EVENT_CHANGED, () => {\n            if (this.eAngleValue.getInputElement().contains(document.activeElement)) {\n                return;\n            }\n            this.updateNumberInput();\n        });\n    }\n\n    private updateNumberInput(): void {\n        const normalizedValue = this.normalizeNegativeValue(this.getValue());\n        this.eAngleValue.setValue(normalizedValue.toString());\n    }\n\n    private positionChildCircle(radians: number) {\n        const rect = this.parentCircleRect || { width: 24, height: 24 };\n        const eChildCircle = this.eChildCircle;\n\n        const centerX = rect.width / 2;\n        const centerY = rect.height / 2;\n\n        eChildCircle.style.left = `${centerX + Math.cos(radians) * 8}px`;\n        eChildCircle.style.top = `${centerY + Math.sin(radians) * 8}px`;\n    }\n\n    private calculatePolar() {\n        const x = this.offsetX;\n        const y = this.offsetY;\n\n        const radians = Math.atan2(y, x);\n        this.degrees = this.toDegrees(radians);\n        this.radius = Math.sqrt((x * x) + (y * y));\n\n        this.positionChildCircle(radians);\n    }\n\n    private calculateCartesian() {\n        const radians = this.toRadians(this.getValue());\n        const radius = this.getRadius();\n\n        this\n            .setOffsetX(Math.cos(radians) * radius)\n            .setOffsetY(Math.sin(radians) * radius);\n    }\n\n    private setOffsetX(offset: number): this {\n        if (this.offsetX !== offset) {\n            this.offsetX = offset;\n            this.calculatePolar();\n        }\n\n        return this;\n    }\n\n    private setOffsetY(offset: number): this {\n        if (this.offsetY !== offset) {\n            this.offsetY = offset;\n            this.calculatePolar();\n        }\n        return this;\n    }\n\n    private calculateAngleDrag(e: MouseEvent | Touch) {\n        const rect = this.parentCircleRect;\n        const centerX = rect.width / 2;\n        const centerY = rect.height / 2;\n\n        const x = e.clientX - rect.left;\n        const y = e.clientY - rect.top;\n\n        const dx = x - centerX;\n        const dy = y - centerY;\n\n        const radians = Math.atan2(dy, dx);\n\n        this.setValue(radians, true);\n    }\n\n    private toDegrees(radians: number): number {\n        return radians / Math.PI * 180;\n    }\n\n    private toRadians(degrees: number): number {\n        return degrees / 180 * Math.PI;\n    }\n\n    private normalizeNegativeValue(degrees: number): number {\n        return degrees < 0 ? 360 + degrees : degrees;\n    }\n\n    private normalizeAngle180(radians: number): number {\n        radians %= Math.PI * 2;\n\n        if (radians < -Math.PI) {\n            radians += Math.PI * 2;\n        } else if (radians >= Math.PI) {\n            radians -= Math.PI * 2;\n        }\n\n        return radians;\n    }\n\n    public getRadius(): number {\n        return this.radius;\n    }\n\n    public setRadius(r: number): this {\n        if (this.radius === r) { return this; }\n        this.radius = r;\n        this.calculateCartesian();\n\n        return this;\n    }\n\n    public onValueChange(callbackFn: (newValue: number) => void): this {\n        this.addManagedListener(this, AgAbstractField.EVENT_CHANGED, () => {\n            callbackFn(this.degrees);\n        });\n        return this;\n    }\n\n    public getValue(radians?: boolean): number {\n        return radians ? this.toRadians(this.degrees) : this.degrees;\n    }\n\n    public setValue(degrees: number, radians?: boolean): this {\n        let radiansValue: number;\n        if (!radians) {\n            radiansValue = this.normalizeAngle180(this.toRadians(degrees));\n        } else {\n            radiansValue = degrees;\n        }\n\n        degrees = this.toDegrees(radiansValue);\n\n        if (this.degrees !== degrees) {\n            this.degrees = Math.floor(degrees);\n            this.calculateCartesian();\n            this.positionChildCircle(radiansValue);\n            this.dispatchEvent({ type: AgAbstractField.EVENT_CHANGED });\n        }\n\n        return this;\n    }\n\n    public setWidth(width: number): this {\n        setFixedWidth(this.getGui(), width);\n        return this;\n    }\n\n    protected destroy(): void {\n        this.dragService.removeDragSource(this.dragListener);\n        super.destroy();\n    }\n}\n"]}