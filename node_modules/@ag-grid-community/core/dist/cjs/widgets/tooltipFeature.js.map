{"version":3,"sources":["../../src/ts/widgets/tooltipFeature.ts"],"names":[],"mappings":"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","file":"tooltipFeature.js","sourcesContent":["import { BeanStub } from \"../context/beanStub\";\nimport { Column } from \"../entities/column\";\nimport { ColumnGroup } from \"../entities/columnGroup\";\nimport { RowNode } from \"../entities/rowNode\";\nimport { Beans } from \"../rendering/beans\";\nimport { escapeString } from \"../utils/string\";\nimport { CustomTooltipFeature, TooltipParentComp } from \"./customTooltipFeature\";\nimport { ITooltipParams } from \"../rendering/tooltipComponent\";\nimport { ColDef, ColGroupDef } from \"../entities/colDef\";\n\nexport interface ITooltipFeatureCtrl {\n    getTooltipValue(): any;\n    getGui(): HTMLElement;\n    getLocation(): string;\n\n    getColumn?(): Column | ColumnGroup;\n    getColDef?(): ColDef | ColGroupDef;\n    getRowIndex?(): number;\n    getRowNode?(): RowNode;\n\n    // this makes no sense, why is the cell formatted value passed to the tooltip???\n    getValueFormatted?(): string;\n}\n\nexport interface ITooltipFeatureComp {\n    setTitle(title: string | undefined): void;\n}\n\nexport class TooltipFeature extends BeanStub {\n\n    private readonly ctrl: ITooltipFeatureCtrl;\n    private readonly beans: Beans;\n\n    private comp: ITooltipFeatureComp;\n\n    private tooltip: any;\n    private tooltipSanatised: string | null;\n\n    private genericTooltipFeature: CustomTooltipFeature;\n    private browserTooltips: boolean;\n\n    constructor(ctrl: ITooltipFeatureCtrl, beans: Beans) {\n        super();\n\n        this.ctrl = ctrl;\n        this.beans = beans;\n    }\n\n    public setComp(comp: ITooltipFeatureComp): void {\n        this.comp = comp;\n        this.setupTooltip();\n    }\n\n    private setupTooltip(): void {\n        this.browserTooltips = this.beans.gridOptionsWrapper.isEnableBrowserTooltips();\n        this.updateTooltipText();\n\n        if (this.browserTooltips) {\n            this.comp.setTitle(this.tooltipSanatised != null ? this.tooltipSanatised : undefined);\n        } else {\n            this.createTooltipFeatureIfNeeded();\n        }\n    }\n\n    private updateTooltipText(): void {\n        this.tooltip = this.ctrl.getTooltipValue();\n        this.tooltipSanatised = escapeString(this.tooltip);\n    }\n\n    private createTooltipFeatureIfNeeded(): void {\n        if (this.genericTooltipFeature != null) { return; }\n\n        const parent: TooltipParentComp = {\n            getTooltipParams: () => this.getTooltipParams(),\n            getGui: () => this.ctrl.getGui()\n        };\n\n        this.genericTooltipFeature = this.createManagedBean(new CustomTooltipFeature(parent), this.beans.context);\n    }\n\n    public refreshToolTip() {\n        this.updateTooltipText();\n\n        if (this.browserTooltips) {\n            this.comp.setTitle(this.tooltipSanatised != null ? this.tooltipSanatised : undefined);\n        }\n    }\n\n    public getTooltipParams(): ITooltipParams {\n        const ctrl = this.ctrl;\n        const column = ctrl.getColumn ? ctrl.getColumn() : undefined;\n        const colDef = ctrl.getColDef ? ctrl.getColDef() : undefined;\n        const rowNode = ctrl.getRowNode ? ctrl.getRowNode() : undefined;\n\n        return {\n            location: ctrl.getLocation(),//'cell',\n            colDef: colDef,\n            column: column,\n            rowIndex: ctrl.getRowIndex ? ctrl.getRowIndex() : undefined,\n            node: rowNode,\n            data: rowNode ? rowNode.data : undefined,\n            value: this.getTooltipText(),\n            valueFormatted: ctrl.getValueFormatted ? ctrl.getValueFormatted() : undefined\n        };\n    }\n\n    private getTooltipText() {\n        return this.tooltip;\n    }\n\n    // overriding to make public, as we don't dispose this bean via context\n    public destroy() {\n        super.destroy();\n    }\n}"]}