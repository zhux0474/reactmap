{"version":3,"sources":["../../src/ts/rendering/cellEditors/textCellEditor.ts"],"names":[],"mappings":"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","file":"textCellEditor.js","sourcesContent":["import { PopupComponent } from \"../../widgets/popupComponent\";\nimport { ICellEditorComp, ICellEditorParams } from \"../../interfaces/iCellEditor\";\nimport { AgInputTextField } from \"../../widgets/agInputTextField\";\nimport { RefSelector } from \"../../widgets/componentAnnotations\";\nimport { exists } from \"../../utils/generic\";\nimport { isBrowserSafari, isBrowserIE } from \"../../utils/browser\";\nimport { KeyCode } from '../../constants/keyCode';\n\n/**\n * useFormatter: used when the cell value needs formatting prior to editing, such as when using reference data and you\n *               want to display text rather than code.\n*/\nexport interface ITextCellEditorParams extends ICellEditorParams {\n    useFormatter: boolean;\n}\n\nexport class TextCellEditor extends PopupComponent implements ICellEditorComp {\n\n    private static TEMPLATE = '<div class=\"ag-cell-edit-wrapper\"><ag-input-text-field class=\"ag-cell-editor\" ref=\"eInput\"></ag-input-text-field></div>';\n\n    private highlightAllOnFocus: boolean;\n    private focusAfterAttached: boolean;\n    protected params: ICellEditorParams;\n    @RefSelector('eInput') protected eInput: AgInputTextField;\n\n    constructor() {\n        super(TextCellEditor.TEMPLATE);\n    }\n\n    public init(params: ITextCellEditorParams): void {\n        this.params = params;\n\n        const eInput = this.eInput;\n        let startValue: string;\n\n        // cellStartedEdit is only false if we are doing fullRow editing\n        if (params.cellStartedEdit) {\n            this.focusAfterAttached = true;\n\n            if (params.keyPress === KeyCode.BACKSPACE || params.keyPress === KeyCode.DELETE) {\n                startValue = '';\n            } else if (params.charPress) {\n                startValue = params.charPress;\n            } else {\n                startValue = this.getStartValue(params);\n\n                if (params.keyPress !== KeyCode.F2) {\n                    this.highlightAllOnFocus = true;\n                }\n            }\n\n        } else {\n            this.focusAfterAttached = false;\n            startValue = this.getStartValue(params);\n        }\n\n        if (startValue != null) {\n            eInput.setValue(startValue, true);\n        }\n\n        this.addManagedListener(eInput.getGui(), 'keydown', (event: KeyboardEvent) => {\n            const { keyCode } = event;\n\n            if (keyCode === KeyCode.PAGE_UP || keyCode === KeyCode.PAGE_DOWN) {\n                event.preventDefault();\n            }\n        });\n    }\n\n    public afterGuiAttached(): void {\n        const translate = this.gridOptionsWrapper.getLocaleTextFunc();\n        const eInput = this.eInput;\n\n        eInput.setInputAriaLabel(translate('ariaInputEditor', 'Input Editor'));\n\n        if (!this.focusAfterAttached) { return; }\n        // Added for AG-3238. We can't remove this explicit focus() because Chrome requires an input\n        // to be focused before setSelectionRange will work. But it triggers a bug in Safari where\n        // explicitly focusing then blurring an empty field will cause the parent container to scroll.\n        if (!isBrowserSafari()) {\n            eInput.getFocusableElement().focus();\n        }\n\n        const inputEl = eInput.getInputElement();\n\n        if (this.highlightAllOnFocus) {\n            inputEl.select();\n        } else {\n            // when we started editing, we want the caret at the end, not the start.\n            // this comes into play in two scenarios: a) when user hits F2 and b)\n            // when user hits a printable character, then on IE (and only IE) the caret\n            // was placed after the first character, thus 'apply' would end up as 'pplea'\n            const value = eInput.getValue();\n            const len = (exists(value) && value.length) || 0;\n\n            if (len) {\n                inputEl.setSelectionRange(len, len);\n            }\n        }\n    }\n\n    // gets called when tabbing trough cells and in full row edit mode\n    public focusIn(): void {\n        const eInput = this.eInput;\n        const focusEl = eInput.getFocusableElement();\n        const inputEl = eInput.getInputElement();\n\n        focusEl.focus();\n        inputEl.select();\n    }\n\n    public focusOut(): void {\n        const inputEl = this.eInput.getInputElement();\n        if (isBrowserIE()) {\n            inputEl.setSelectionRange(0, 0);\n        }\n    }\n\n    public getValue(): any {\n        const eInput = this.eInput;\n        return this.params.parseValue(eInput.getValue());\n    }\n\n    private getStartValue(params: ITextCellEditorParams) {\n        const formatValue = params.useFormatter || params.column.getColDef().refData;\n        return formatValue ? params.formatValue(params.value) : params.value;\n    }\n    public isPopup() {\n        return false;\n    }\n}\n"]}