{"version":3,"sources":["../../src/ts/rendering/cellRenderers/animateShowChangeCellRenderer.ts"],"names":[],"mappings":"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","file":"animateShowChangeCellRenderer.js","sourcesContent":["import { Autowired } from \"../../context/context\";\nimport { ICellRenderer } from \"./iCellRenderer\";\nimport { Component } from \"../../widgets/component\";\nimport { FilterManager } from \"../../filter/filterManager\";\nimport { exists } from \"../../utils/generic\";\nimport { addOrRemoveCssClass, removeCssClass, clearElement, addCssClass } from \"../../utils/dom\";\n\nconst ARROW_UP = '\\u2191';\nconst ARROW_DOWN = '\\u2193';\n\nexport class AnimateShowChangeCellRenderer extends Component implements ICellRenderer {\n\n    private static TEMPLATE =\n        '<span>' +\n        '<span class=\"ag-value-change-delta\"></span>' +\n        '<span class=\"ag-value-change-value\"></span>' +\n        '</span>';\n\n    // private params: any;\n    private lastValue: number;\n\n    private eValue: HTMLElement;\n    private eDelta: HTMLElement;\n\n    private refreshCount = 0;\n\n    @Autowired('filterManager') private filterManager: FilterManager;\n\n    constructor() {\n        super(AnimateShowChangeCellRenderer.TEMPLATE);\n    }\n\n    public init(params: any): void {\n        // this.params = params;\n\n        this.eValue = this.queryForHtmlElement('.ag-value-change-value');\n        this.eDelta = this.queryForHtmlElement('.ag-value-change-delta');\n\n        this.refresh(params);\n    }\n\n    private showDelta(params: any, delta: number): void {\n\n        const absDelta = Math.abs(delta);\n        const valueFormatted = params.formatValue(absDelta);\n\n        const valueToUse = exists(valueFormatted) ? valueFormatted : absDelta;\n\n        const deltaUp = (delta >= 0);\n\n        if (deltaUp) {\n            this.eDelta.innerHTML = ARROW_UP + valueToUse;\n        } else {\n            // because negative, use ABS to remove sign\n            this.eDelta.innerHTML = ARROW_DOWN + valueToUse;\n        }\n\n        addOrRemoveCssClass(this.eDelta, 'ag-value-change-delta-up', deltaUp);\n        addOrRemoveCssClass(this.eDelta, 'ag-value-change-delta-down', !deltaUp);\n    }\n\n    private setTimerToRemoveDelta(): void {\n        // the refreshCount makes sure that if the value updates again while\n        // the below timer is waiting, then the below timer will realise it\n        // is not the most recent and will not try to remove the delta value.\n        this.refreshCount++;\n        const refreshCountCopy = this.refreshCount;\n        window.setTimeout(() => {\n            if (refreshCountCopy === this.refreshCount) {\n                this.hideDeltaValue();\n            }\n        }, 2000);\n    }\n\n    private hideDeltaValue(): void {\n        removeCssClass(this.eValue, 'ag-value-change-value-highlight');\n        clearElement(this.eDelta);\n    }\n\n    public refresh(params: any): boolean {\n        const value = params.value;\n\n        if (value === this.lastValue) {\n            return false;\n        }\n\n        if (exists(params.valueFormatted)) {\n            this.eValue.innerHTML = params.valueFormatted;\n        } else if (exists(params.value)) {\n            this.eValue.innerHTML = value;\n        } else {\n            clearElement(this.eValue);\n        }\n\n        // we don't show the delta if we are in the middle of a filter. see comment on FilterManager\n        // with regards processingFilterChange\n        if (this.filterManager.isSuppressFlashingCellsBecauseFiltering()) {\n            return false;\n        }\n\n        if (typeof value === 'number' && typeof this.lastValue === 'number') {\n            const delta = value - this.lastValue;\n            this.showDelta(params, delta);\n        }\n\n        // highlight the current value, but only if it's not new, otherwise it\n        // would get highlighted first time the value is shown\n        if (this.lastValue) {\n            addCssClass(this.eValue, 'ag-value-change-value-highlight');\n        }\n\n        this.setTimerToRemoveDelta();\n\n        this.lastValue = value;\n\n        return true;\n    }\n}\n"]}