{"version":3,"sources":["../../src/ts/gridComp/gridCtrl.ts"],"names":[],"mappings":"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","file":"gridCtrl.js","sourcesContent":["import { Autowired, Optional, PostConstruct } from \"../context/context\";\nimport { GridApi } from \"../gridApi\";\nimport { FocusService } from \"../focusService\";\nimport { BeanStub } from \"../context/beanStub\";\nimport { ModuleRegistry } from \"../modules/moduleRegistry\";\nimport { ModuleNames } from \"../modules/moduleNames\";\nimport { IClipboardService } from \"../interfaces/iClipboardService\";\nimport { LayoutFeature, LayoutView } from \"../styling/layoutFeature\";\nimport { Events } from \"../eventKeys\";\nimport { Logger, LoggerFactory } from \"../logger\";\nimport { ResizeObserverService } from \"../misc/resizeObserverService\";\nimport { GridSizeChangedEvent } from \"../events\";\nimport { ColumnApi } from \"../columns/columnApi\";\nimport { findIndex, last } from \"../utils/array\";\nimport { Column } from \"../entities/column\";\nimport { ColumnGroup } from \"../entities/columnGroup\";\nimport { ColumnModel } from \"../columns/columnModel\";\nimport { CtrlsService } from \"../ctrlsService\";\nimport { MouseEventService } from \"../gridBodyComp/mouseEventService\";\n\nexport interface IGridComp extends LayoutView {\n    setRtlClass(cssClass: string): void;\n    destroyGridUi(): void;\n    forceFocusOutOfContainer(up: boolean): void;\n    addOrRemoveKeyboardFocusClass(value: boolean): void;\n    getFocusableContainers(): HTMLElement[];\n    setCursor(value: string | null): void;\n    setUserSelect(value: string | null): void;\n}\n\nexport class GridCtrl extends BeanStub {\n\n    @Autowired('columnApi') private readonly columnApi: ColumnApi;\n    @Autowired('gridApi') private readonly gridApi: GridApi;\n    @Autowired('focusService') protected readonly focusService: FocusService;\n    @Autowired('resizeObserverService') private readonly resizeObserverService: ResizeObserverService;\n    @Autowired('columnModel') private readonly columnModel: ColumnModel;\n    @Autowired('ctrlsService') private readonly ctrlsService: CtrlsService;\n    @Autowired('mouseEventService') private readonly mouseEventService: MouseEventService;\n\n    private view: IGridComp;\n    private eGridHostDiv: HTMLElement;\n    private eGui: HTMLElement;\n\n    @PostConstruct\n    protected postConstruct(): void {\n        this.ctrlsService.registerGridCtrl(this);\n    }\n\n    public setComp(view: IGridComp, eGridDiv: HTMLElement, eGui: HTMLElement): void {\n        this.view = view;\n        this.eGridHostDiv = eGridDiv;\n        this.eGui = eGui;\n\n        this.mouseEventService.stampTopLevelGridCompWithGridInstance(eGridDiv);\n\n        this.createManagedBean(new LayoutFeature(this.view));\n\n        // important to set rtl before doLayout, as setting the RTL class impacts the scroll position,\n        // which doLayout indirectly depends on\n        this.addRtlSupport();\n\n        this.addManagedListener(this, Events.EVENT_KEYBOARD_FOCUS, () => {\n            this.view.addOrRemoveKeyboardFocusClass(true);\n        });\n\n        this.addManagedListener(this, Events.EVENT_MOUSE_FOCUS, () => {\n            this.view.addOrRemoveKeyboardFocusClass(false);\n        });\n\n        const unsubscribeFromResize = this.resizeObserverService.observeResize(\n            this.eGridHostDiv, this.onGridSizeChanged.bind(this));\n        this.addDestroyFunc(() => unsubscribeFromResize());\n    }\n\n    public showDropZones(): boolean {\n        return ModuleRegistry.isRegistered(ModuleNames.RowGroupingModule);\n    }\n\n    public showSideBar(): boolean {\n        return ModuleRegistry.isRegistered(ModuleNames.SideBarModule);\n    }\n\n    public showStatusBar(): boolean {\n        return ModuleRegistry.isRegistered(ModuleNames.StatusBarModule);\n    }\n\n    public showWatermark(): boolean {\n        return ModuleRegistry.isRegistered(ModuleNames.EnterpriseCoreModule);\n    }\n\n    private onGridSizeChanged(): void {\n        const event: GridSizeChangedEvent = {\n            type: Events.EVENT_GRID_SIZE_CHANGED,\n            api: this.gridApi,\n            columnApi: this.columnApi,\n            clientWidth: this.eGridHostDiv.clientWidth,\n            clientHeight: this.eGridHostDiv.clientHeight\n        };\n        this.eventService.dispatchEvent(event);\n    }\n\n    private addRtlSupport(): void {\n        const cssClass = this.gridOptionsWrapper.isEnableRtl() ? 'ag-rtl' : 'ag-ltr';\n        this.view.setRtlClass(cssClass);\n    }\n\n    public destroyGridUi(): void {\n        this.view.destroyGridUi();\n    }\n\n    public getGui(): HTMLElement {\n        return this.eGui;\n    }\n\n    public setResizeCursor(on: boolean): void {\n        this.view.setCursor(on ? 'ew-resize' : null);\n    }\n\n    public disableUserSelect(on: boolean): void {\n        this.view.setUserSelect(on ? 'none' : null);\n    }\n\n    public focusNextInnerContainer(backwards: boolean): boolean {\n        const focusableContainers = this.view.getFocusableContainers();\n        const idxWithFocus = findIndex(focusableContainers, container => container.contains(document.activeElement));\n        const nextIdx = idxWithFocus + (backwards ? -1 : 1);\n\n        if (nextIdx < 0 || nextIdx >= focusableContainers.length) {\n            return false;\n        }\n\n        if (nextIdx === 0) {\n            return this.focusGridHeader();\n        }\n\n        return this.focusService.focusInto(focusableContainers[nextIdx]);\n    }\n\n    public focusInnerElement(fromBottom?: boolean) {\n        const focusableContainers = this.view.getFocusableContainers();\n\n        if (fromBottom) {\n            if (focusableContainers.length > 1) {\n                return this.focusService.focusInto(last(focusableContainers), true);\n            }\n\n            const lastColumn = last(this.columnModel.getAllDisplayedColumns());\n            if (this.focusService.focusGridView(lastColumn, true)) { return true; }\n        }\n\n        return this.focusGridHeader();\n    }\n\n    public focusGridHeader(): boolean {\n        let firstColumn: Column | ColumnGroup = this.columnModel.getAllDisplayedColumns()[0];\n        if (!firstColumn) { return false; }\n\n        if (firstColumn.getParent()) {\n            firstColumn = this.columnModel.getColumnGroupAtLevel(firstColumn, 0)!;\n        }\n\n        this.focusService.focusHeaderPosition({\n            headerPosition: { headerRowIndex: 0, column: firstColumn }\n        });\n\n        return true;\n    }\n\n    public forceFocusOutOfContainer(up = false): void {\n        this.view.forceFocusOutOfContainer(up);\n    }\n\n}"]}