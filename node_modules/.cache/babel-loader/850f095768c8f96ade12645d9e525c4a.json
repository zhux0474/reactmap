{"ast":null,"code":"/**\n * @ag-grid-community/core - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components\n * @version v26.2.1\n * @link http://www.ag-grid.com/\n * @license MIT\n */\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { Autowired, Bean, PostConstruct } from \"../context/context\";\nimport { Events } from '../events';\nimport { BeanStub } from \"../context/beanStub\";\nimport { addCssClass, addOrRemoveCssClass, containsClass, getAbsoluteHeight, getAbsoluteWidth, removeCssClass } from '../utils/dom';\nimport { findIndex, forEach, last, some } from '../utils/array';\nimport { isElementInEventPath } from '../utils/event';\nimport { KeyCode } from '../constants/keyCode';\nimport { FocusService } from \"../focusService\";\nimport { AgPromise } from \"../utils\";\nimport { setAriaLabel, setAriaRole } from \"../utils/aria\";\nvar DIRECTION;\n\n(function (DIRECTION) {\n  DIRECTION[DIRECTION[\"vertical\"] = 0] = \"vertical\";\n  DIRECTION[DIRECTION[\"horizontal\"] = 1] = \"horizontal\";\n})(DIRECTION || (DIRECTION = {}));\n\nvar instanceIdSeq = 0;\n\nvar PopupService =\n/** @class */\nfunction (_super) {\n  __extends(PopupService, _super);\n\n  function PopupService() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.popupList = [];\n    return _this;\n  }\n\n  PopupService.prototype.postConstruct = function () {\n    var _this = this;\n\n    this.ctrlsService.whenReady(function (p) {\n      _this.gridCtrl = p.gridCtrl;\n\n      _this.addManagedListener(_this.gridCtrl, Events.EVENT_KEYBOARD_FOCUS, function () {\n        forEach(_this.popupList, function (popup) {\n          return addCssClass(popup.element, FocusService.AG_KEYBOARD_FOCUS);\n        });\n      });\n\n      _this.addManagedListener(_this.gridCtrl, Events.EVENT_MOUSE_FOCUS, function () {\n        forEach(_this.popupList, function (popup) {\n          return removeCssClass(popup.element, FocusService.AG_KEYBOARD_FOCUS);\n        });\n      });\n    });\n  };\n\n  PopupService.prototype.getPopupParent = function () {\n    var ePopupParent = this.gridOptionsWrapper.getPopupParent();\n\n    if (ePopupParent) {\n      return ePopupParent;\n    }\n\n    return this.gridCtrl.getGui();\n  };\n\n  PopupService.prototype.positionPopupForMenu = function (params) {\n    var sourceRect = params.eventSource.getBoundingClientRect();\n    var parentRect = this.getParentRect();\n    var y = this.keepXYWithinBounds(params.ePopup, sourceRect.top - parentRect.top, DIRECTION.vertical);\n    var minWidth = params.ePopup.clientWidth > 0 ? params.ePopup.clientWidth : 200;\n    params.ePopup.style.minWidth = minWidth + \"px\";\n    var widthOfParent = parentRect.right - parentRect.left;\n    var maxX = widthOfParent - minWidth; // the x position of the popup depends on RTL or LTR. for normal cases, LTR, we put the child popup\n    // to the right, unless it doesn't fit and we then put it to the left. for RTL it's the other way around,\n    // we try place it first to the left, and then if not to the right.\n\n    var x;\n\n    if (this.gridOptionsWrapper.isEnableRtl()) {\n      // for RTL, try left first\n      x = xLeftPosition();\n\n      if (x < 0) {\n        x = xRightPosition();\n      }\n\n      if (x > maxX) {\n        x = 0;\n      }\n    } else {\n      // for LTR, try right first\n      x = xRightPosition();\n\n      if (x > maxX) {\n        x = xLeftPosition();\n      }\n\n      if (x < 0) {\n        x = 0;\n      }\n    }\n\n    params.ePopup.style.left = x + \"px\";\n    params.ePopup.style.top = y + \"px\";\n\n    function xRightPosition() {\n      return sourceRect.right - parentRect.left - 2;\n    }\n\n    function xLeftPosition() {\n      return sourceRect.left - parentRect.left - minWidth;\n    }\n  };\n\n  PopupService.prototype.positionPopupUnderMouseEvent = function (params) {\n    var ePopup = params.ePopup,\n        nudgeX = params.nudgeX,\n        nudgeY = params.nudgeY;\n\n    var _a = this.calculatePointerAlign(params.mouseEvent),\n        x = _a.x,\n        y = _a.y;\n\n    this.positionPopup({\n      ePopup: ePopup,\n      x: x,\n      y: y,\n      nudgeX: nudgeX,\n      nudgeY: nudgeY,\n      keepWithinBounds: true\n    });\n    this.callPostProcessPopup(params.type, params.ePopup, null, params.mouseEvent, params.column, params.rowNode);\n  };\n\n  PopupService.prototype.calculatePointerAlign = function (e) {\n    var parentRect = this.getParentRect();\n    return {\n      x: e.clientX - parentRect.left,\n      y: e.clientY - parentRect.top\n    };\n  };\n\n  PopupService.prototype.positionPopupUnderComponent = function (params) {\n    var sourceRect = params.eventSource.getBoundingClientRect();\n    var alignSide = params.alignSide || 'left';\n    var parentRect = this.getParentRect();\n    var x = sourceRect.left - parentRect.left;\n\n    if (alignSide === 'right') {\n      x -= params.ePopup.offsetWidth - sourceRect.width;\n    }\n\n    this.positionPopup({\n      ePopup: params.ePopup,\n      nudgeX: params.nudgeX,\n      nudgeY: params.nudgeY,\n      x: x,\n      y: sourceRect.top - parentRect.top + sourceRect.height,\n      keepWithinBounds: params.keepWithinBounds\n    });\n    this.callPostProcessPopup(params.type, params.ePopup, params.eventSource, null, params.column, params.rowNode);\n  };\n\n  PopupService.prototype.positionPopupOverComponent = function (params) {\n    var sourceRect = params.eventSource.getBoundingClientRect();\n    var parentRect = this.getParentRect();\n    this.positionPopup({\n      ePopup: params.ePopup,\n      nudgeX: params.nudgeX,\n      nudgeY: params.nudgeY,\n      x: sourceRect.left - parentRect.left,\n      y: sourceRect.top - parentRect.top,\n      keepWithinBounds: params.keepWithinBounds\n    });\n    this.callPostProcessPopup(params.type, params.ePopup, params.eventSource, null, params.column, params.rowNode);\n  };\n\n  PopupService.prototype.callPostProcessPopup = function (type, ePopup, eventSource, mouseEvent, column, rowNode) {\n    var callback = this.gridOptionsWrapper.getPostProcessPopupFunc();\n\n    if (callback) {\n      var params = {\n        column: column,\n        rowNode: rowNode,\n        ePopup: ePopup,\n        type: type,\n        eventSource: eventSource,\n        mouseEvent: mouseEvent\n      };\n      callback(params);\n    }\n  };\n\n  PopupService.prototype.positionPopup = function (params) {\n    var ePopup = params.ePopup,\n        keepWithinBounds = params.keepWithinBounds,\n        nudgeX = params.nudgeX,\n        nudgeY = params.nudgeY;\n    var x = params.x,\n        y = params.y;\n\n    if (nudgeX) {\n      x += nudgeX;\n    }\n\n    if (nudgeY) {\n      y += nudgeY;\n    } // if popup is overflowing to the bottom, move it up\n\n\n    if (keepWithinBounds) {\n      x = this.keepXYWithinBounds(ePopup, x, DIRECTION.horizontal);\n      y = this.keepXYWithinBounds(ePopup, y, DIRECTION.vertical);\n    }\n\n    ePopup.style.left = x + \"px\";\n    ePopup.style.top = y + \"px\";\n  };\n\n  PopupService.prototype.getActivePopups = function () {\n    return this.popupList.map(function (popup) {\n      return popup.element;\n    });\n  };\n\n  PopupService.prototype.getPopupList = function () {\n    return this.popupList;\n  };\n\n  PopupService.prototype.getParentRect = function () {\n    // subtract the popup parent borders, because popupParent.getBoundingClientRect\n    // returns the rect outside the borders, but the 0,0 coordinate for absolute\n    // positioning is inside the border, leading the popup to be off by the width\n    // of the border\n    var eDocument = this.gridOptionsWrapper.getDocument();\n    var popupParent = this.getPopupParent();\n\n    if (popupParent === eDocument.body) {\n      popupParent = eDocument.documentElement;\n    }\n\n    var style = getComputedStyle(popupParent);\n    var bounds = popupParent.getBoundingClientRect();\n    return {\n      top: bounds.top + parseFloat(style.borderTopWidth) || 0,\n      left: bounds.left + parseFloat(style.borderLeftWidth) || 0,\n      right: bounds.right + parseFloat(style.borderRightWidth) || 0,\n      bottom: bounds.bottom + parseFloat(style.borderBottomWidth) || 0\n    };\n  };\n\n  PopupService.prototype.keepXYWithinBounds = function (ePopup, position, direction) {\n    var isVertical = direction === DIRECTION.vertical;\n    var sizeProperty = isVertical ? 'clientHeight' : 'clientWidth';\n    var anchorProperty = isVertical ? 'top' : 'left';\n    var offsetProperty = isVertical ? 'offsetHeight' : 'offsetWidth';\n    var scrollPositionProperty = isVertical ? 'scrollTop' : 'scrollLeft';\n    var eDocument = this.gridOptionsWrapper.getDocument();\n    var docElement = eDocument.documentElement;\n    var popupParent = this.getPopupParent();\n    var parentRect = popupParent.getBoundingClientRect();\n    var documentRect = eDocument.documentElement.getBoundingClientRect();\n    var isBody = popupParent === eDocument.body;\n    var offsetSize = ePopup[offsetProperty];\n    var getSize = isVertical ? getAbsoluteHeight : getAbsoluteWidth;\n    var sizeOfParent = isBody ? getSize(docElement) + docElement[scrollPositionProperty] : popupParent[sizeProperty];\n\n    if (isBody) {\n      sizeOfParent -= Math.abs(documentRect[anchorProperty] - parentRect[anchorProperty]);\n    }\n\n    var max = sizeOfParent - offsetSize;\n    return Math.min(Math.max(position, 0), Math.abs(max));\n  };\n\n  PopupService.prototype.keepPopupPositionedRelativeTo = function (params) {\n    var _this = this;\n\n    var eParent = this.getPopupParent();\n    var parentRect = eParent.getBoundingClientRect();\n    var sourceRect = params.element.getBoundingClientRect();\n    var initialDiffTop = parentRect.top - sourceRect.top;\n    var initialDiffLeft = parentRect.left - sourceRect.left;\n    var lastDiffTop = initialDiffTop;\n    var lastDiffLeft = initialDiffLeft;\n    var topPx = params.ePopup.style.top;\n    var top = parseInt(topPx.substring(0, topPx.length - 1), 10);\n    var leftPx = params.ePopup.style.left;\n    var left = parseInt(leftPx.substring(0, leftPx.length - 1), 10);\n    return new AgPromise(function (resolve) {\n      _this.getFrameworkOverrides().setInterval(function () {\n        var pRect = eParent.getBoundingClientRect();\n        var sRect = params.element.getBoundingClientRect();\n        var elementNotInDom = sRect.top == 0 && sRect.left == 0 && sRect.height == 0 && sRect.width == 0;\n\n        if (elementNotInDom) {\n          params.hidePopup();\n          return;\n        }\n\n        var currentDiffTop = pRect.top - sRect.top;\n\n        if (currentDiffTop != lastDiffTop) {\n          var newTop = _this.keepXYWithinBounds(params.ePopup, top + initialDiffTop - currentDiffTop, DIRECTION.vertical);\n\n          params.ePopup.style.top = newTop + \"px\";\n        }\n\n        lastDiffTop = currentDiffTop;\n        var currentDiffLeft = pRect.left - sRect.left;\n\n        if (currentDiffLeft != lastDiffLeft) {\n          var newLeft = _this.keepXYWithinBounds(params.ePopup, left + initialDiffLeft - currentDiffLeft, DIRECTION.horizontal);\n\n          params.ePopup.style.left = newLeft + \"px\";\n        }\n\n        lastDiffLeft = currentDiffLeft;\n      }, 200).then(function (intervalId) {\n        var result = function () {\n          if (intervalId != null) {\n            window.clearInterval(intervalId);\n          }\n        };\n\n        resolve(result);\n      });\n    });\n  };\n\n  PopupService.prototype.addPopup = function (params) {\n    var _this = this;\n\n    var modal = params.modal,\n        eChild = params.eChild,\n        closeOnEsc = params.closeOnEsc,\n        closedCallback = params.closedCallback,\n        click = params.click,\n        alwaysOnTop = params.alwaysOnTop,\n        afterGuiAttached = params.afterGuiAttached,\n        positionCallback = params.positionCallback,\n        anchorToElement = params.anchorToElement,\n        ariaLabel = params.ariaLabel;\n    var eDocument = this.gridOptionsWrapper.getDocument();\n    var destroyPositionTracker = new AgPromise(function (resolve) {\n      return resolve(function () {});\n    });\n\n    if (!eDocument) {\n      console.warn('ag-grid: could not find the document, document is empty');\n      return {\n        hideFunc: function () {},\n        stopAnchoringPromise: destroyPositionTracker\n      };\n    }\n\n    var pos = findIndex(this.popupList, function (popup) {\n      return popup.element === eChild;\n    });\n\n    if (pos !== -1) {\n      var popup = this.popupList[pos];\n      return {\n        hideFunc: popup.hideFunc,\n        stopAnchoringPromise: popup.stopAnchoringPromise\n      };\n    }\n\n    var ePopupParent = this.getPopupParent();\n\n    if (eChild.style.top == null) {\n      eChild.style.top = '0px';\n    }\n\n    if (eChild.style.left == null) {\n      eChild.style.left = '0px';\n    } // add env CSS class to child, in case user provided a popup parent, which means\n    // theme class may be missing\n\n\n    var eWrapper = document.createElement('div');\n    var theme = this.environment.getTheme().theme;\n\n    if (theme) {\n      addCssClass(eWrapper, theme);\n    }\n\n    addCssClass(eWrapper, 'ag-popup');\n    addCssClass(eChild, this.gridOptionsWrapper.isEnableRtl() ? 'ag-rtl' : 'ag-ltr');\n    addCssClass(eChild, 'ag-popup-child');\n    setAriaRole(eChild, 'dialog');\n    setAriaLabel(eChild, ariaLabel);\n\n    if (this.focusService.isKeyboardMode()) {\n      addCssClass(eChild, FocusService.AG_KEYBOARD_FOCUS);\n    }\n\n    eWrapper.appendChild(eChild);\n    ePopupParent.appendChild(eWrapper);\n\n    if (alwaysOnTop) {\n      this.setAlwaysOnTop(eWrapper, true);\n    } else {\n      this.bringPopupToFront(eWrapper);\n    }\n\n    var popupHidden = false;\n\n    var hidePopupOnKeyboardEvent = function (event) {\n      if (!eWrapper.contains(document.activeElement)) {\n        return;\n      }\n\n      var key = event.which || event.keyCode;\n\n      if (key === KeyCode.ESCAPE) {\n        hidePopup({\n          keyboardEvent: event\n        });\n      }\n    };\n\n    var hidePopupOnMouseEvent = function (event) {\n      return hidePopup({\n        mouseEvent: event\n      });\n    };\n\n    var hidePopupOnTouchEvent = function (event) {\n      return hidePopup({\n        touchEvent: event\n      });\n    };\n\n    var hidePopup = function (popupParams) {\n      if (popupParams === void 0) {\n        popupParams = {};\n      }\n\n      var mouseEvent = popupParams.mouseEvent,\n          touchEvent = popupParams.touchEvent,\n          keyboardEvent = popupParams.keyboardEvent;\n\n      if ( // we don't hide popup if the event was on the child, or any\n      // children of this child\n      _this.isEventFromCurrentPopup({\n        mouseEvent: mouseEvent,\n        touchEvent: touchEvent\n      }, eChild) || // if the event to close is actually the open event, then ignore it\n      _this.isEventSameChainAsOriginalEvent({\n        originalMouseEvent: click,\n        mouseEvent: mouseEvent,\n        touchEvent: touchEvent\n      }) || // this method should only be called once. the client can have different\n      // paths, each one wanting to close, so this method may be called multiple times.\n      popupHidden) {\n        return;\n      }\n\n      popupHidden = true;\n      ePopupParent.removeChild(eWrapper);\n      eDocument.removeEventListener('keydown', hidePopupOnKeyboardEvent);\n      eDocument.removeEventListener('mousedown', hidePopupOnMouseEvent);\n      eDocument.removeEventListener('touchstart', hidePopupOnTouchEvent);\n      eDocument.removeEventListener('contextmenu', hidePopupOnMouseEvent);\n\n      _this.eventService.removeEventListener(Events.EVENT_DRAG_STARTED, hidePopupOnMouseEvent);\n\n      if (closedCallback) {\n        closedCallback(mouseEvent || touchEvent || keyboardEvent);\n      }\n\n      _this.popupList = _this.popupList.filter(function (popup) {\n        return popup.element !== eChild;\n      });\n\n      if (destroyPositionTracker) {\n        destroyPositionTracker.then(function (destroyFunc) {\n          return destroyFunc && destroyFunc();\n        });\n      }\n    };\n\n    if (afterGuiAttached) {\n      afterGuiAttached({\n        hidePopup: hidePopup\n      });\n    } // if we add these listeners now, then the current mouse\n    // click will be included, which we don't want\n\n\n    window.setTimeout(function () {\n      if (closeOnEsc) {\n        eDocument.addEventListener('keydown', hidePopupOnKeyboardEvent);\n      }\n\n      if (modal) {\n        eDocument.addEventListener('mousedown', hidePopupOnMouseEvent);\n\n        _this.eventService.addEventListener(Events.EVENT_DRAG_STARTED, hidePopupOnMouseEvent);\n\n        eDocument.addEventListener('touchstart', hidePopupOnTouchEvent);\n        eDocument.addEventListener('contextmenu', hidePopupOnMouseEvent);\n      }\n    }, 0);\n\n    if (positionCallback) {\n      positionCallback();\n    }\n\n    if (anchorToElement) {\n      // keeps popup positioned under created, eg if context menu, if user scrolls\n      // using touchpad and the cell moves, it moves the popup to keep it with the cell.\n      destroyPositionTracker = this.keepPopupPositionedRelativeTo({\n        element: anchorToElement,\n        ePopup: eChild,\n        hidePopup: hidePopup\n      });\n    }\n\n    this.popupList.push({\n      element: eChild,\n      wrapper: eWrapper,\n      hideFunc: hidePopup,\n      stopAnchoringPromise: destroyPositionTracker,\n      instanceId: instanceIdSeq++,\n      isAnchored: !!anchorToElement\n    });\n    return {\n      hideFunc: hidePopup,\n      stopAnchoringPromise: destroyPositionTracker\n    };\n  };\n\n  PopupService.prototype.hasAnchoredPopup = function () {\n    return some(this.popupList, function (popup) {\n      return popup.isAnchored;\n    });\n  };\n\n  PopupService.prototype.isEventFromCurrentPopup = function (params, target) {\n    var mouseEvent = params.mouseEvent,\n        touchEvent = params.touchEvent;\n    var event = mouseEvent ? mouseEvent : touchEvent;\n\n    if (!event) {\n      return false;\n    }\n\n    var indexOfThisChild = findIndex(this.popupList, function (popup) {\n      return popup.element === target;\n    });\n\n    if (indexOfThisChild === -1) {\n      return false;\n    }\n\n    for (var i = indexOfThisChild; i < this.popupList.length; i++) {\n      var popup = this.popupList[i];\n\n      if (isElementInEventPath(popup.element, event)) {\n        return true;\n      }\n    } // if the user did not write their own Custom Element to be rendered as popup\n    // and this component has an additional popup element, they should have the\n    // `ag-custom-component-popup` class to be detected as part of the Custom Component\n\n\n    return this.isElementWithinCustomPopup(event.target);\n  };\n\n  PopupService.prototype.isElementWithinCustomPopup = function (el) {\n    while (el && el !== document.body) {\n      if (el.classList.contains('ag-custom-component-popup') || el.parentElement === null) {\n        return true;\n      }\n\n      el = el.parentElement;\n    }\n\n    return false;\n  }; // in some browsers, the context menu event can be fired before the click event, which means\n  // the context menu event could open the popup, but then the click event closes it straight away.\n\n\n  PopupService.prototype.isEventSameChainAsOriginalEvent = function (params) {\n    var originalMouseEvent = params.originalMouseEvent,\n        mouseEvent = params.mouseEvent,\n        touchEvent = params.touchEvent; // we check the coordinates of the event, to see if it's the same event. there is a 1 / 1000 chance that\n    // the event is a different event, however that is an edge case that is not very relevant (the user clicking\n    // twice on the same location isn't a normal path).\n    // event could be mouse event or touch event.\n\n    var mouseEventOrTouch = null;\n\n    if (mouseEvent) {\n      // mouse event can be used direction, it has coordinates\n      mouseEventOrTouch = mouseEvent;\n    } else if (touchEvent) {\n      // touch event doesn't have coordinates, need it's touch object\n      mouseEventOrTouch = touchEvent.touches[0];\n    }\n\n    if (mouseEventOrTouch && originalMouseEvent) {\n      // for x, allow 4px margin, to cover iPads, where touch (which opens menu) is followed\n      // by browser click (when you finger up, touch is interrupted as click in browser)\n      var screenX_1 = mouseEvent ? mouseEvent.screenX : 0;\n      var screenY_1 = mouseEvent ? mouseEvent.screenY : 0;\n      var xMatch = Math.abs(originalMouseEvent.screenX - screenX_1) < 5;\n      var yMatch = Math.abs(originalMouseEvent.screenY - screenY_1) < 5;\n\n      if (xMatch && yMatch) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  PopupService.prototype.getWrapper = function (ePopup) {\n    while (!containsClass(ePopup, 'ag-popup') && ePopup.parentElement) {\n      ePopup = ePopup.parentElement;\n    }\n\n    return containsClass(ePopup, 'ag-popup') ? ePopup : null;\n  };\n\n  PopupService.prototype.setAlwaysOnTop = function (ePopup, alwaysOnTop) {\n    var eWrapper = this.getWrapper(ePopup);\n\n    if (!eWrapper) {\n      return;\n    }\n\n    addOrRemoveCssClass(eWrapper, 'ag-always-on-top', !!alwaysOnTop);\n\n    if (alwaysOnTop) {\n      this.bringPopupToFront(eWrapper);\n    }\n  };\n\n  PopupService.prototype.bringPopupToFront = function (ePopup) {\n    var parent = this.getPopupParent();\n    var popupList = Array.prototype.slice.call(parent.querySelectorAll('.ag-popup'));\n    var popupLen = popupList.length;\n    var alwaysOnTopList = Array.prototype.slice.call(parent.querySelectorAll('.ag-popup.ag-always-on-top'));\n    var onTopLength = alwaysOnTopList.length;\n    var eWrapper = this.getWrapper(ePopup);\n\n    if (!eWrapper || popupLen <= 1 || !parent.contains(ePopup)) {\n      return;\n    }\n\n    var pos = popupList.indexOf(eWrapper);\n\n    if (onTopLength) {\n      var isPopupAlwaysOnTop = containsClass(eWrapper, 'ag-always-on-top');\n\n      if (isPopupAlwaysOnTop) {\n        if (pos !== popupLen - 1) {\n          last(alwaysOnTopList).insertAdjacentElement('afterend', eWrapper);\n        }\n      } else if (pos !== popupLen - onTopLength - 1) {\n        alwaysOnTopList[0].insertAdjacentElement('beforebegin', eWrapper);\n      }\n    } else if (pos !== popupLen - 1) {\n      last(popupList).insertAdjacentElement('afterend', eWrapper);\n    }\n\n    var params = {\n      type: 'popupToFront',\n      api: this.gridOptionsWrapper.getApi(),\n      columnApi: this.gridOptionsWrapper.getColumnApi(),\n      eWrapper: eWrapper\n    };\n    this.eventService.dispatchEvent(params);\n  };\n\n  __decorate([Autowired('environment')], PopupService.prototype, \"environment\", void 0);\n\n  __decorate([Autowired('focusService')], PopupService.prototype, \"focusService\", void 0);\n\n  __decorate([Autowired('ctrlsService')], PopupService.prototype, \"ctrlsService\", void 0);\n\n  __decorate([PostConstruct], PopupService.prototype, \"postConstruct\", null);\n\n  PopupService = __decorate([Bean('popupService')], PopupService);\n  return PopupService;\n}(BeanStub);\n\nexport { PopupService };","map":{"version":3,"sources":["/Users/rongxuan/Desktop/reactmap/reactmap/node_modules/@ag-grid-community/core/dist/es6/widgets/popupService.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","Autowired","Bean","PostConstruct","Events","BeanStub","addCssClass","addOrRemoveCssClass","containsClass","getAbsoluteHeight","getAbsoluteWidth","removeCssClass","findIndex","forEach","last","some","isElementInEventPath","KeyCode","FocusService","AgPromise","setAriaLabel","setAriaRole","DIRECTION","instanceIdSeq","PopupService","_super","_this","apply","popupList","postConstruct","ctrlsService","whenReady","gridCtrl","addManagedListener","EVENT_KEYBOARD_FOCUS","popup","element","AG_KEYBOARD_FOCUS","EVENT_MOUSE_FOCUS","getPopupParent","ePopupParent","gridOptionsWrapper","getGui","positionPopupForMenu","params","sourceRect","eventSource","getBoundingClientRect","parentRect","getParentRect","y","keepXYWithinBounds","ePopup","top","vertical","minWidth","clientWidth","style","widthOfParent","right","left","maxX","x","isEnableRtl","xLeftPosition","xRightPosition","positionPopupUnderMouseEvent","nudgeX","nudgeY","_a","calculatePointerAlign","mouseEvent","positionPopup","keepWithinBounds","callPostProcessPopup","type","column","rowNode","e","clientX","clientY","positionPopupUnderComponent","alignSide","offsetWidth","width","height","positionPopupOverComponent","callback","getPostProcessPopupFunc","horizontal","getActivePopups","map","getPopupList","eDocument","getDocument","popupParent","body","documentElement","getComputedStyle","bounds","parseFloat","borderTopWidth","borderLeftWidth","borderRightWidth","bottom","borderBottomWidth","position","direction","isVertical","sizeProperty","anchorProperty","offsetProperty","scrollPositionProperty","docElement","documentRect","isBody","offsetSize","getSize","sizeOfParent","Math","abs","max","min","keepPopupPositionedRelativeTo","eParent","initialDiffTop","initialDiffLeft","lastDiffTop","lastDiffLeft","topPx","parseInt","substring","leftPx","resolve","getFrameworkOverrides","setInterval","pRect","sRect","elementNotInDom","hidePopup","currentDiffTop","newTop","currentDiffLeft","newLeft","then","intervalId","result","window","clearInterval","addPopup","modal","eChild","closeOnEsc","closedCallback","click","alwaysOnTop","afterGuiAttached","positionCallback","anchorToElement","ariaLabel","destroyPositionTracker","console","warn","hideFunc","stopAnchoringPromise","pos","eWrapper","document","createElement","theme","environment","getTheme","focusService","isKeyboardMode","appendChild","setAlwaysOnTop","bringPopupToFront","popupHidden","hidePopupOnKeyboardEvent","event","contains","activeElement","which","keyCode","ESCAPE","keyboardEvent","hidePopupOnMouseEvent","hidePopupOnTouchEvent","touchEvent","popupParams","isEventFromCurrentPopup","isEventSameChainAsOriginalEvent","originalMouseEvent","removeChild","removeEventListener","eventService","EVENT_DRAG_STARTED","filter","destroyFunc","setTimeout","addEventListener","push","wrapper","instanceId","isAnchored","hasAnchoredPopup","indexOfThisChild","isElementWithinCustomPopup","el","classList","parentElement","mouseEventOrTouch","touches","screenX_1","screenX","screenY_1","screenY","xMatch","yMatch","getWrapper","parent","slice","call","querySelectorAll","popupLen","alwaysOnTopList","onTopLength","indexOf","isPopupAlwaysOnTop","insertAdjacentElement","api","getApi","columnApi","getColumnApi","dispatchEvent"],"mappings":"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","sourcesContent":["/**\n * @ag-grid-community/core - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components\n * @version v26.2.1\n * @link http://www.ag-grid.com/\n * @license MIT\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Autowired, Bean, PostConstruct } from \"../context/context\";\nimport { Events } from '../events';\nimport { BeanStub } from \"../context/beanStub\";\nimport { addCssClass, addOrRemoveCssClass, containsClass, getAbsoluteHeight, getAbsoluteWidth, removeCssClass } from '../utils/dom';\nimport { findIndex, forEach, last, some } from '../utils/array';\nimport { isElementInEventPath } from '../utils/event';\nimport { KeyCode } from '../constants/keyCode';\nimport { FocusService } from \"../focusService\";\nimport { AgPromise } from \"../utils\";\nimport { setAriaLabel, setAriaRole } from \"../utils/aria\";\nvar DIRECTION;\n(function (DIRECTION) {\n    DIRECTION[DIRECTION[\"vertical\"] = 0] = \"vertical\";\n    DIRECTION[DIRECTION[\"horizontal\"] = 1] = \"horizontal\";\n})(DIRECTION || (DIRECTION = {}));\nvar instanceIdSeq = 0;\nvar PopupService = /** @class */ (function (_super) {\n    __extends(PopupService, _super);\n    function PopupService() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.popupList = [];\n        return _this;\n    }\n    PopupService.prototype.postConstruct = function () {\n        var _this = this;\n        this.ctrlsService.whenReady(function (p) {\n            _this.gridCtrl = p.gridCtrl;\n            _this.addManagedListener(_this.gridCtrl, Events.EVENT_KEYBOARD_FOCUS, function () {\n                forEach(_this.popupList, function (popup) { return addCssClass(popup.element, FocusService.AG_KEYBOARD_FOCUS); });\n            });\n            _this.addManagedListener(_this.gridCtrl, Events.EVENT_MOUSE_FOCUS, function () {\n                forEach(_this.popupList, function (popup) { return removeCssClass(popup.element, FocusService.AG_KEYBOARD_FOCUS); });\n            });\n        });\n    };\n    PopupService.prototype.getPopupParent = function () {\n        var ePopupParent = this.gridOptionsWrapper.getPopupParent();\n        if (ePopupParent) {\n            return ePopupParent;\n        }\n        return this.gridCtrl.getGui();\n    };\n    PopupService.prototype.positionPopupForMenu = function (params) {\n        var sourceRect = params.eventSource.getBoundingClientRect();\n        var parentRect = this.getParentRect();\n        var y = this.keepXYWithinBounds(params.ePopup, sourceRect.top - parentRect.top, DIRECTION.vertical);\n        var minWidth = (params.ePopup.clientWidth > 0) ? params.ePopup.clientWidth : 200;\n        params.ePopup.style.minWidth = minWidth + \"px\";\n        var widthOfParent = parentRect.right - parentRect.left;\n        var maxX = widthOfParent - minWidth;\n        // the x position of the popup depends on RTL or LTR. for normal cases, LTR, we put the child popup\n        // to the right, unless it doesn't fit and we then put it to the left. for RTL it's the other way around,\n        // we try place it first to the left, and then if not to the right.\n        var x;\n        if (this.gridOptionsWrapper.isEnableRtl()) {\n            // for RTL, try left first\n            x = xLeftPosition();\n            if (x < 0) {\n                x = xRightPosition();\n            }\n            if (x > maxX) {\n                x = 0;\n            }\n        }\n        else {\n            // for LTR, try right first\n            x = xRightPosition();\n            if (x > maxX) {\n                x = xLeftPosition();\n            }\n            if (x < 0) {\n                x = 0;\n            }\n        }\n        params.ePopup.style.left = x + \"px\";\n        params.ePopup.style.top = y + \"px\";\n        function xRightPosition() {\n            return sourceRect.right - parentRect.left - 2;\n        }\n        function xLeftPosition() {\n            return sourceRect.left - parentRect.left - minWidth;\n        }\n    };\n    PopupService.prototype.positionPopupUnderMouseEvent = function (params) {\n        var ePopup = params.ePopup, nudgeX = params.nudgeX, nudgeY = params.nudgeY;\n        var _a = this.calculatePointerAlign(params.mouseEvent), x = _a.x, y = _a.y;\n        this.positionPopup({\n            ePopup: ePopup,\n            x: x,\n            y: y,\n            nudgeX: nudgeX,\n            nudgeY: nudgeY,\n            keepWithinBounds: true\n        });\n        this.callPostProcessPopup(params.type, params.ePopup, null, params.mouseEvent, params.column, params.rowNode);\n    };\n    PopupService.prototype.calculatePointerAlign = function (e) {\n        var parentRect = this.getParentRect();\n        return {\n            x: e.clientX - parentRect.left,\n            y: e.clientY - parentRect.top\n        };\n    };\n    PopupService.prototype.positionPopupUnderComponent = function (params) {\n        var sourceRect = params.eventSource.getBoundingClientRect();\n        var alignSide = params.alignSide || 'left';\n        var parentRect = this.getParentRect();\n        var x = sourceRect.left - parentRect.left;\n        if (alignSide === 'right') {\n            x -= (params.ePopup.offsetWidth - sourceRect.width);\n        }\n        this.positionPopup({\n            ePopup: params.ePopup,\n            nudgeX: params.nudgeX,\n            nudgeY: params.nudgeY,\n            x: x,\n            y: sourceRect.top - parentRect.top + sourceRect.height,\n            keepWithinBounds: params.keepWithinBounds\n        });\n        this.callPostProcessPopup(params.type, params.ePopup, params.eventSource, null, params.column, params.rowNode);\n    };\n    PopupService.prototype.positionPopupOverComponent = function (params) {\n        var sourceRect = params.eventSource.getBoundingClientRect();\n        var parentRect = this.getParentRect();\n        this.positionPopup({\n            ePopup: params.ePopup,\n            nudgeX: params.nudgeX,\n            nudgeY: params.nudgeY,\n            x: sourceRect.left - parentRect.left,\n            y: sourceRect.top - parentRect.top,\n            keepWithinBounds: params.keepWithinBounds\n        });\n        this.callPostProcessPopup(params.type, params.ePopup, params.eventSource, null, params.column, params.rowNode);\n    };\n    PopupService.prototype.callPostProcessPopup = function (type, ePopup, eventSource, mouseEvent, column, rowNode) {\n        var callback = this.gridOptionsWrapper.getPostProcessPopupFunc();\n        if (callback) {\n            var params = {\n                column: column,\n                rowNode: rowNode,\n                ePopup: ePopup,\n                type: type,\n                eventSource: eventSource,\n                mouseEvent: mouseEvent\n            };\n            callback(params);\n        }\n    };\n    PopupService.prototype.positionPopup = function (params) {\n        var ePopup = params.ePopup, keepWithinBounds = params.keepWithinBounds, nudgeX = params.nudgeX, nudgeY = params.nudgeY;\n        var x = params.x, y = params.y;\n        if (nudgeX) {\n            x += nudgeX;\n        }\n        if (nudgeY) {\n            y += nudgeY;\n        }\n        // if popup is overflowing to the bottom, move it up\n        if (keepWithinBounds) {\n            x = this.keepXYWithinBounds(ePopup, x, DIRECTION.horizontal);\n            y = this.keepXYWithinBounds(ePopup, y, DIRECTION.vertical);\n        }\n        ePopup.style.left = x + \"px\";\n        ePopup.style.top = y + \"px\";\n    };\n    PopupService.prototype.getActivePopups = function () {\n        return this.popupList.map(function (popup) { return popup.element; });\n    };\n    PopupService.prototype.getPopupList = function () {\n        return this.popupList;\n    };\n    PopupService.prototype.getParentRect = function () {\n        // subtract the popup parent borders, because popupParent.getBoundingClientRect\n        // returns the rect outside the borders, but the 0,0 coordinate for absolute\n        // positioning is inside the border, leading the popup to be off by the width\n        // of the border\n        var eDocument = this.gridOptionsWrapper.getDocument();\n        var popupParent = this.getPopupParent();\n        if (popupParent === eDocument.body) {\n            popupParent = eDocument.documentElement;\n        }\n        var style = getComputedStyle(popupParent);\n        var bounds = popupParent.getBoundingClientRect();\n        return {\n            top: bounds.top + parseFloat(style.borderTopWidth) || 0,\n            left: bounds.left + parseFloat(style.borderLeftWidth) || 0,\n            right: bounds.right + parseFloat(style.borderRightWidth) || 0,\n            bottom: bounds.bottom + parseFloat(style.borderBottomWidth) || 0,\n        };\n    };\n    PopupService.prototype.keepXYWithinBounds = function (ePopup, position, direction) {\n        var isVertical = direction === DIRECTION.vertical;\n        var sizeProperty = isVertical ? 'clientHeight' : 'clientWidth';\n        var anchorProperty = isVertical ? 'top' : 'left';\n        var offsetProperty = isVertical ? 'offsetHeight' : 'offsetWidth';\n        var scrollPositionProperty = isVertical ? 'scrollTop' : 'scrollLeft';\n        var eDocument = this.gridOptionsWrapper.getDocument();\n        var docElement = eDocument.documentElement;\n        var popupParent = this.getPopupParent();\n        var parentRect = popupParent.getBoundingClientRect();\n        var documentRect = eDocument.documentElement.getBoundingClientRect();\n        var isBody = popupParent === eDocument.body;\n        var offsetSize = ePopup[offsetProperty];\n        var getSize = isVertical ? getAbsoluteHeight : getAbsoluteWidth;\n        var sizeOfParent = isBody ? (getSize(docElement) + docElement[scrollPositionProperty]) : popupParent[sizeProperty];\n        if (isBody) {\n            sizeOfParent -= Math.abs(documentRect[anchorProperty] - parentRect[anchorProperty]);\n        }\n        var max = sizeOfParent - offsetSize;\n        return Math.min(Math.max(position, 0), Math.abs(max));\n    };\n    PopupService.prototype.keepPopupPositionedRelativeTo = function (params) {\n        var _this = this;\n        var eParent = this.getPopupParent();\n        var parentRect = eParent.getBoundingClientRect();\n        var sourceRect = params.element.getBoundingClientRect();\n        var initialDiffTop = parentRect.top - sourceRect.top;\n        var initialDiffLeft = parentRect.left - sourceRect.left;\n        var lastDiffTop = initialDiffTop;\n        var lastDiffLeft = initialDiffLeft;\n        var topPx = params.ePopup.style.top;\n        var top = parseInt(topPx.substring(0, topPx.length - 1), 10);\n        var leftPx = params.ePopup.style.left;\n        var left = parseInt(leftPx.substring(0, leftPx.length - 1), 10);\n        return new AgPromise(function (resolve) {\n            _this.getFrameworkOverrides().setInterval(function () {\n                var pRect = eParent.getBoundingClientRect();\n                var sRect = params.element.getBoundingClientRect();\n                var elementNotInDom = sRect.top == 0 && sRect.left == 0 && sRect.height == 0 && sRect.width == 0;\n                if (elementNotInDom) {\n                    params.hidePopup();\n                    return;\n                }\n                var currentDiffTop = pRect.top - sRect.top;\n                if (currentDiffTop != lastDiffTop) {\n                    var newTop = _this.keepXYWithinBounds(params.ePopup, top + initialDiffTop - currentDiffTop, DIRECTION.vertical);\n                    params.ePopup.style.top = newTop + \"px\";\n                }\n                lastDiffTop = currentDiffTop;\n                var currentDiffLeft = pRect.left - sRect.left;\n                if (currentDiffLeft != lastDiffLeft) {\n                    var newLeft = _this.keepXYWithinBounds(params.ePopup, left + initialDiffLeft - currentDiffLeft, DIRECTION.horizontal);\n                    params.ePopup.style.left = newLeft + \"px\";\n                }\n                lastDiffLeft = currentDiffLeft;\n            }, 200).then(function (intervalId) {\n                var result = function () {\n                    if (intervalId != null) {\n                        window.clearInterval(intervalId);\n                    }\n                };\n                resolve(result);\n            });\n        });\n    };\n    PopupService.prototype.addPopup = function (params) {\n        var _this = this;\n        var modal = params.modal, eChild = params.eChild, closeOnEsc = params.closeOnEsc, closedCallback = params.closedCallback, click = params.click, alwaysOnTop = params.alwaysOnTop, afterGuiAttached = params.afterGuiAttached, positionCallback = params.positionCallback, anchorToElement = params.anchorToElement, ariaLabel = params.ariaLabel;\n        var eDocument = this.gridOptionsWrapper.getDocument();\n        var destroyPositionTracker = new AgPromise(function (resolve) { return resolve(function () { }); });\n        if (!eDocument) {\n            console.warn('ag-grid: could not find the document, document is empty');\n            return { hideFunc: function () { }, stopAnchoringPromise: destroyPositionTracker };\n        }\n        var pos = findIndex(this.popupList, function (popup) { return popup.element === eChild; });\n        if (pos !== -1) {\n            var popup = this.popupList[pos];\n            return { hideFunc: popup.hideFunc, stopAnchoringPromise: popup.stopAnchoringPromise };\n        }\n        var ePopupParent = this.getPopupParent();\n        if (eChild.style.top == null) {\n            eChild.style.top = '0px';\n        }\n        if (eChild.style.left == null) {\n            eChild.style.left = '0px';\n        }\n        // add env CSS class to child, in case user provided a popup parent, which means\n        // theme class may be missing\n        var eWrapper = document.createElement('div');\n        var theme = this.environment.getTheme().theme;\n        if (theme) {\n            addCssClass(eWrapper, theme);\n        }\n        addCssClass(eWrapper, 'ag-popup');\n        addCssClass(eChild, this.gridOptionsWrapper.isEnableRtl() ? 'ag-rtl' : 'ag-ltr');\n        addCssClass(eChild, 'ag-popup-child');\n        setAriaRole(eChild, 'dialog');\n        setAriaLabel(eChild, ariaLabel);\n        if (this.focusService.isKeyboardMode()) {\n            addCssClass(eChild, FocusService.AG_KEYBOARD_FOCUS);\n        }\n        eWrapper.appendChild(eChild);\n        ePopupParent.appendChild(eWrapper);\n        if (alwaysOnTop) {\n            this.setAlwaysOnTop(eWrapper, true);\n        }\n        else {\n            this.bringPopupToFront(eWrapper);\n        }\n        var popupHidden = false;\n        var hidePopupOnKeyboardEvent = function (event) {\n            if (!eWrapper.contains(document.activeElement)) {\n                return;\n            }\n            var key = event.which || event.keyCode;\n            if (key === KeyCode.ESCAPE) {\n                hidePopup({ keyboardEvent: event });\n            }\n        };\n        var hidePopupOnMouseEvent = function (event) { return hidePopup({ mouseEvent: event }); };\n        var hidePopupOnTouchEvent = function (event) { return hidePopup({ touchEvent: event }); };\n        var hidePopup = function (popupParams) {\n            if (popupParams === void 0) { popupParams = {}; }\n            var mouseEvent = popupParams.mouseEvent, touchEvent = popupParams.touchEvent, keyboardEvent = popupParams.keyboardEvent;\n            if (\n            // we don't hide popup if the event was on the child, or any\n            // children of this child\n            _this.isEventFromCurrentPopup({ mouseEvent: mouseEvent, touchEvent: touchEvent }, eChild) ||\n                // if the event to close is actually the open event, then ignore it\n                _this.isEventSameChainAsOriginalEvent({ originalMouseEvent: click, mouseEvent: mouseEvent, touchEvent: touchEvent }) ||\n                // this method should only be called once. the client can have different\n                // paths, each one wanting to close, so this method may be called multiple times.\n                popupHidden) {\n                return;\n            }\n            popupHidden = true;\n            ePopupParent.removeChild(eWrapper);\n            eDocument.removeEventListener('keydown', hidePopupOnKeyboardEvent);\n            eDocument.removeEventListener('mousedown', hidePopupOnMouseEvent);\n            eDocument.removeEventListener('touchstart', hidePopupOnTouchEvent);\n            eDocument.removeEventListener('contextmenu', hidePopupOnMouseEvent);\n            _this.eventService.removeEventListener(Events.EVENT_DRAG_STARTED, hidePopupOnMouseEvent);\n            if (closedCallback) {\n                closedCallback(mouseEvent || touchEvent || keyboardEvent);\n            }\n            _this.popupList = _this.popupList.filter(function (popup) { return popup.element !== eChild; });\n            if (destroyPositionTracker) {\n                destroyPositionTracker.then(function (destroyFunc) { return destroyFunc && destroyFunc(); });\n            }\n        };\n        if (afterGuiAttached) {\n            afterGuiAttached({ hidePopup: hidePopup });\n        }\n        // if we add these listeners now, then the current mouse\n        // click will be included, which we don't want\n        window.setTimeout(function () {\n            if (closeOnEsc) {\n                eDocument.addEventListener('keydown', hidePopupOnKeyboardEvent);\n            }\n            if (modal) {\n                eDocument.addEventListener('mousedown', hidePopupOnMouseEvent);\n                _this.eventService.addEventListener(Events.EVENT_DRAG_STARTED, hidePopupOnMouseEvent);\n                eDocument.addEventListener('touchstart', hidePopupOnTouchEvent);\n                eDocument.addEventListener('contextmenu', hidePopupOnMouseEvent);\n            }\n        }, 0);\n        if (positionCallback) {\n            positionCallback();\n        }\n        if (anchorToElement) {\n            // keeps popup positioned under created, eg if context menu, if user scrolls\n            // using touchpad and the cell moves, it moves the popup to keep it with the cell.\n            destroyPositionTracker = this.keepPopupPositionedRelativeTo({\n                element: anchorToElement,\n                ePopup: eChild,\n                hidePopup: hidePopup\n            });\n        }\n        this.popupList.push({\n            element: eChild,\n            wrapper: eWrapper,\n            hideFunc: hidePopup,\n            stopAnchoringPromise: destroyPositionTracker,\n            instanceId: instanceIdSeq++,\n            isAnchored: !!anchorToElement\n        });\n        return {\n            hideFunc: hidePopup,\n            stopAnchoringPromise: destroyPositionTracker\n        };\n    };\n    PopupService.prototype.hasAnchoredPopup = function () {\n        return some(this.popupList, function (popup) { return popup.isAnchored; });\n    };\n    PopupService.prototype.isEventFromCurrentPopup = function (params, target) {\n        var mouseEvent = params.mouseEvent, touchEvent = params.touchEvent;\n        var event = mouseEvent ? mouseEvent : touchEvent;\n        if (!event) {\n            return false;\n        }\n        var indexOfThisChild = findIndex(this.popupList, function (popup) { return popup.element === target; });\n        if (indexOfThisChild === -1) {\n            return false;\n        }\n        for (var i = indexOfThisChild; i < this.popupList.length; i++) {\n            var popup = this.popupList[i];\n            if (isElementInEventPath(popup.element, event)) {\n                return true;\n            }\n        }\n        // if the user did not write their own Custom Element to be rendered as popup\n        // and this component has an additional popup element, they should have the\n        // `ag-custom-component-popup` class to be detected as part of the Custom Component\n        return this.isElementWithinCustomPopup(event.target);\n    };\n    PopupService.prototype.isElementWithinCustomPopup = function (el) {\n        while (el && el !== document.body) {\n            if (el.classList.contains('ag-custom-component-popup') || el.parentElement === null) {\n                return true;\n            }\n            el = el.parentElement;\n        }\n        return false;\n    };\n    // in some browsers, the context menu event can be fired before the click event, which means\n    // the context menu event could open the popup, but then the click event closes it straight away.\n    PopupService.prototype.isEventSameChainAsOriginalEvent = function (params) {\n        var originalMouseEvent = params.originalMouseEvent, mouseEvent = params.mouseEvent, touchEvent = params.touchEvent;\n        // we check the coordinates of the event, to see if it's the same event. there is a 1 / 1000 chance that\n        // the event is a different event, however that is an edge case that is not very relevant (the user clicking\n        // twice on the same location isn't a normal path).\n        // event could be mouse event or touch event.\n        var mouseEventOrTouch = null;\n        if (mouseEvent) {\n            // mouse event can be used direction, it has coordinates\n            mouseEventOrTouch = mouseEvent;\n        }\n        else if (touchEvent) {\n            // touch event doesn't have coordinates, need it's touch object\n            mouseEventOrTouch = touchEvent.touches[0];\n        }\n        if (mouseEventOrTouch && originalMouseEvent) {\n            // for x, allow 4px margin, to cover iPads, where touch (which opens menu) is followed\n            // by browser click (when you finger up, touch is interrupted as click in browser)\n            var screenX_1 = mouseEvent ? mouseEvent.screenX : 0;\n            var screenY_1 = mouseEvent ? mouseEvent.screenY : 0;\n            var xMatch = Math.abs(originalMouseEvent.screenX - screenX_1) < 5;\n            var yMatch = Math.abs(originalMouseEvent.screenY - screenY_1) < 5;\n            if (xMatch && yMatch) {\n                return true;\n            }\n        }\n        return false;\n    };\n    PopupService.prototype.getWrapper = function (ePopup) {\n        while (!containsClass(ePopup, 'ag-popup') && ePopup.parentElement) {\n            ePopup = ePopup.parentElement;\n        }\n        return containsClass(ePopup, 'ag-popup') ? ePopup : null;\n    };\n    PopupService.prototype.setAlwaysOnTop = function (ePopup, alwaysOnTop) {\n        var eWrapper = this.getWrapper(ePopup);\n        if (!eWrapper) {\n            return;\n        }\n        addOrRemoveCssClass(eWrapper, 'ag-always-on-top', !!alwaysOnTop);\n        if (alwaysOnTop) {\n            this.bringPopupToFront(eWrapper);\n        }\n    };\n    PopupService.prototype.bringPopupToFront = function (ePopup) {\n        var parent = this.getPopupParent();\n        var popupList = Array.prototype.slice.call(parent.querySelectorAll('.ag-popup'));\n        var popupLen = popupList.length;\n        var alwaysOnTopList = Array.prototype.slice.call(parent.querySelectorAll('.ag-popup.ag-always-on-top'));\n        var onTopLength = alwaysOnTopList.length;\n        var eWrapper = this.getWrapper(ePopup);\n        if (!eWrapper || popupLen <= 1 || !parent.contains(ePopup)) {\n            return;\n        }\n        var pos = popupList.indexOf(eWrapper);\n        if (onTopLength) {\n            var isPopupAlwaysOnTop = containsClass(eWrapper, 'ag-always-on-top');\n            if (isPopupAlwaysOnTop) {\n                if (pos !== popupLen - 1) {\n                    last(alwaysOnTopList).insertAdjacentElement('afterend', eWrapper);\n                }\n            }\n            else if (pos !== popupLen - onTopLength - 1) {\n                alwaysOnTopList[0].insertAdjacentElement('beforebegin', eWrapper);\n            }\n        }\n        else if (pos !== popupLen - 1) {\n            last(popupList).insertAdjacentElement('afterend', eWrapper);\n        }\n        var params = {\n            type: 'popupToFront',\n            api: this.gridOptionsWrapper.getApi(),\n            columnApi: this.gridOptionsWrapper.getColumnApi(),\n            eWrapper: eWrapper\n        };\n        this.eventService.dispatchEvent(params);\n    };\n    __decorate([\n        Autowired('environment')\n    ], PopupService.prototype, \"environment\", void 0);\n    __decorate([\n        Autowired('focusService')\n    ], PopupService.prototype, \"focusService\", void 0);\n    __decorate([\n        Autowired('ctrlsService')\n    ], PopupService.prototype, \"ctrlsService\", void 0);\n    __decorate([\n        PostConstruct\n    ], PopupService.prototype, \"postConstruct\", null);\n    PopupService = __decorate([\n        Bean('popupService')\n    ], PopupService);\n    return PopupService;\n}(BeanStub));\nexport { PopupService };\n"]},"metadata":{},"sourceType":"module"}