{"ast":null,"code":"var _jsxFileName = \"/Users/rongxuan/Desktop/reactmap/reactmap/src/components/SmokerMap.js\";\nimport React from \"react\";\nimport { fromLonLat, get } from \"ol/proj\"; //import \"./SmokerMap.css\";\n\nimport Map from \"ol/Map\"; //import Feature from \"ol/Feature\";\n\nimport View from \"ol/View\"; //import { Point, Style, Circle, Fill, Feature } from \"ol\";\n\nimport TileLayer from \"ol/layer/Tile\"; //import TileWMS from 'ol/source/TileWMS';\n\nimport VectorLayer from \"ol/layer/Vector\";\nimport VectorSource from \"ol/source/Vector\";\nimport GeoJSON from 'ol/format/GeoJSON';\nimport OSM from \"ol/source/OSM\";\nimport { Fill, Stroke, Style } from 'ol/style';\nimport { metadata } from './metadata.js';\nimport countyData from './countyline.geojson';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class SmokerMap extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.setLayerVisibility = viewed => {\n      this.state.countyOutline.setVisible(viewed === 'County');\n      this.state.smokerlayer.setVisible(viewed === 'County');\n    };\n\n    this.isReady = (prevProps, name) => {\n      return (!this.state[name + 'Loaded'] || prevProps.date !== this.props.date || prevProps[name + 'Data'] !== this.props[name + 'Data'] || prevProps.selected !== this.props.selected || prevProps.colors !== this.props.colors || prevProps.selectedFeatures !== this.props.selectedFeatures || prevProps.highlighted !== this.props.highlighted) && (this.props[name + 'Data'] != null || this.props.selected === 'customLayer') && this.state[name + 'Source'] != null && this.state[name + 'Ready'] && this.props.date != null;\n    };\n\n    this.checkAndLoad = (prevProps, name) => {\n      if (this.isReady(prevProps, name)) {\n        // we don't want to add the cases again (except for on a new date) so set the loaded to true\n        this.setState({\n          [name + 'Loaded']: true\n        });\n        this.addField(this.props[name + 'Data'], name + \"Source\", this.props.fieldName);\n      }\n    };\n\n    this.componentDidUpdate = (prevProps, prevState) => {\n      if (prevProps.viewed !== this.props.viewed) {\n        this.setLayerVisibility(this.props.viewed);\n      }\n\n      var checkAndLoad = name => this.checkAndLoad(prevProps, name);\n\n      checkAndLoad('county');\n    };\n\n    this.state = {\n      smokerSource: null,\n      smokerlayer: false,\n      countyOutlineSource: null,\n      countyOutline: false,\n      countyReady: false\n    }; //console.log(this.props);\n  }\n\n  componentDidMount() {\n    var basemap = new TileLayer({\n      source: new OSM()\n    }); // use usestate to update the url base on \n\n    var smokerSource = new VectorSource({\n      url: metadata[1]['geojson_url'],\n      format: new GeoJSON()\n    });\n    var countyOutlineSource = new VectorSource({\n      url: countyData,\n      format: new GeoJSON()\n    });\n    var countyBorder = new Style({\n      stroke: new Stroke({\n        color: 'black',\n        width: 1\n      })\n    });\n    var countyOutline = new VectorLayer({\n      opacity: 1,\n      //visible: this.props.viewed === 'County',\n      source: countyOutlineSource,\n      style: countyBorder\n    });\n\n    var stylefunction = function (feature) {\n      var style;\n      var value = feature.get('brfss_smoker'); //var county=feature.get('county');\n      // assign color to each break from metadata.js\n      //console.log(county,value)\n\n      for (let i = 0; i < metadata[1]['break'].length; i++) {\n        if (value > metadata[1]['break'][i]) {\n          style = new Style({\n            fill: new Fill({\n              color: metadata[1]['color'][i]\n            }),\n            stroke: new Stroke({\n              color: 'black',\n              width: 0.3\n            })\n          });\n        }\n\n        ;\n      }\n\n      return style;\n    };\n\n    var smokerlayer = new VectorLayer({\n      source: smokerSource,\n      style: stylefunction //showLegend:true\n\n    });\n    var olmap = new Map({\n      layers: [basemap, countyOutline, smokerlayer],\n      target: \"mapContainer\",\n      view: new View({\n        center: fromLonLat([-94.6859, 46.7296]),\n        zoom: 6\n      })\n    });\n    this.setState({\n      olmap: olmap,\n      countyOutlineSource: countyOutlineSource,\n      countyOutline: countyOutline,\n      smokerlayer: smokerlayer,\n      smokerSource: smokerSource\n    }); // when the geographic county data is loaded in add it to state of react object\n\n    countyOutlineSource.on('change', evt => {\n      var countyOutlineSource = evt.target;\n\n      if (countyOutlineSource.getState() === 'ready') {\n        // note that brackets are needed for dynamic names\n        this.setState({\n          countyData: countyOutlineSource.getFeatures()\n        });\n      }\n    });\n    smokerlayer.on(\"postrender\", event => {\n      this.setState({\n        countyReady: true\n      });\n    });\n    /*\n    \n    */\n  }\n\n  render() {\n    console.log(\"-> render App\");\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"mapContainer\",\n      style: {\n        width: \"100%\",\n        height: \"500px\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/rongxuan/Desktop/reactmap/reactmap/src/components/SmokerMap.js"],"names":["React","fromLonLat","get","Map","View","TileLayer","VectorLayer","VectorSource","GeoJSON","OSM","Fill","Stroke","Style","metadata","countyData","SmokerMap","Component","constructor","props","setLayerVisibility","viewed","state","countyOutline","setVisible","smokerlayer","isReady","prevProps","name","date","selected","colors","selectedFeatures","highlighted","checkAndLoad","setState","addField","fieldName","componentDidUpdate","prevState","smokerSource","countyOutlineSource","countyReady","componentDidMount","basemap","source","url","format","countyBorder","stroke","color","width","opacity","style","stylefunction","feature","value","i","length","fill","olmap","layers","target","view","center","zoom","on","evt","getState","getFeatures","event","render","console","log","height"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { fromLonLat, get } from \"ol/proj\";\n//import \"./SmokerMap.css\";\nimport Map from \"ol/Map\";\n//import Feature from \"ol/Feature\";\nimport View from \"ol/View\";\n//import { Point, Style, Circle, Fill, Feature } from \"ol\";\nimport TileLayer from \"ol/layer/Tile\";\n//import TileWMS from 'ol/source/TileWMS';\nimport VectorLayer from \"ol/layer/Vector\";\nimport VectorSource from \"ol/source/Vector\";\nimport GeoJSON from 'ol/format/GeoJSON';\nimport OSM from \"ol/source/OSM\";\nimport {Fill, Stroke, Style} from 'ol/style';\nimport {metadata} from './metadata.js';\nimport countyData from './countyline.geojson'\n\n\nexport default class SmokerMap extends React.Component{\n  constructor(props){\n    super(props);\n    this.state = {\n     \n      smokerSource : null,\n      smokerlayer: false,\n      countyOutlineSource: null,\n      countyOutline: false,\n      countyReady: false\n      \n  };\n    //console.log(this.props);\n  }\n\n\n  componentDidMount(){\n\n    var basemap =new TileLayer({\n      source: new OSM()\n    })\n    \n\n    // use usestate to update the url base on \n    var smokerSource = new VectorSource({\n      url:metadata[1]['geojson_url'],\n\n      format: new GeoJSON()\n    })\n    \n\n    var countyOutlineSource = new VectorSource({\n      url: countyData,\n      format: new GeoJSON()\n\n    })\n    var countyBorder = new Style({\n      stroke: new Stroke({\n          color: 'black',\n          width: 1\n      })\n  });\n    var countyOutline = new VectorLayer({\n      opacity: 1,\n      //visible: this.props.viewed === 'County',\n      source: countyOutlineSource,\n      style: countyBorder\n    })\n  \n    var stylefunction = function(feature){\n        var style;\n        \n        var value=feature.get('brfss_smoker');\n        //var county=feature.get('county');\n        \n        // assign color to each break from metadata.js\n        //console.log(county,value)\n        for (let i =0;i<metadata[1]['break'].length;i++){\n          if(value>metadata[1]['break'][i]){\n          style= new Style({\n            fill: new Fill({\n              color: metadata[1]['color'][i]\n            }),\n            stroke: new Stroke({\n              color:'black',\n              width:0.3\n            })\n          })\n        };\n      }\n\n        return style;\n\n    };\n\n    var smokerlayer = new VectorLayer({\n\n       source: smokerSource,\n       style: stylefunction,\n       //showLegend:true\n\n       })\n\n    var olmap=new Map({\n      layers: [basemap,countyOutline,smokerlayer],\n      target: \"mapContainer\",\n      view :new View({\n        center:fromLonLat([-94.6859,46.7296]),\n        zoom: 6\n      })\n\n\n\n    });\n\n    this.setState({\n      \n      olmap: olmap,\n      countyOutlineSource:countyOutlineSource,\n      countyOutline: countyOutline,\n      smokerlayer: smokerlayer,\n      smokerSource:smokerSource\n  })\n\n  // when the geographic county data is loaded in add it to state of react object\n  countyOutlineSource.on('change', (evt) => {\n    var countyOutlineSource=evt.target;\n    if (countyOutlineSource.getState() === 'ready'){\n        // note that brackets are needed for dynamic names\n        this.setState({countyData: countyOutlineSource.getFeatures()});\n    }\n})\n\n\n\n\nsmokerlayer.on(\"postrender\", (event) => {\n  this.setState({countyReady: true})\n});\n\n/*\n\n*/\n  }\n\n  setLayerVisibility = viewed => {\n\n    this.state.countyOutline.setVisible(viewed === 'County')\n    this.state.smokerlayer.setVisible(viewed === 'County')\n  }\n  isReady = (prevProps, name) => {\n    return (!this.state[name + 'Loaded'] || prevProps.date !== this.props.date\n        || prevProps[name + 'Data'] !== this.props[name + 'Data'] || prevProps.selected !== this.props.selected\n        || prevProps.colors !== this.props.colors || prevProps.selectedFeatures !== this.props.selectedFeatures\n        || prevProps.highlighted !== this.props.highlighted)\n        && (this.props[name + 'Data'] != null || this.props.selected === 'customLayer')\n        && this.state[name + 'Source'] != null\n        && this.state[name + 'Ready']\n        && this.props.date != null\n}\n  checkAndLoad = (prevProps, name) => {\n    if (this.isReady(prevProps, name)) {\n        // we don't want to add the cases again (except for on a new date) so set the loaded to true\n        this.setState({[name + 'Loaded']: true})\n        this.addField(this.props[name + 'Data'], name + \"Source\", this.props.fieldName)\n    }\n  }\ncomponentDidUpdate = (prevProps, prevState) => {\n  if (prevProps.viewed !== this.props.viewed) {\n      this.setLayerVisibility(this.props.viewed)\n  }\n  var checkAndLoad = (name) =>  this.checkAndLoad(prevProps, name)\n  \n  checkAndLoad('county')\n}\n\n\n  \n\n  \n  render() {\n    console.log(\"-> render App\");\n    return (\n\n\n      <div id=\"mapContainer\" style={{ width: \"100%\",height: \"500px\"}}></div>\n      \n\n\n    );\n  }\n\n\n}\n"]},"metadata":{},"sourceType":"module"}